<html>
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <title>網址檢測管理</title>
    <style type="text/css">
    .definitionErrorRules{
    	height:31px;
    }
    </style>
	</head>
  <body>
	 <form  id="urlCheckForm" name="urlCheckForm" method="post">
	  <input type="hidden" id="id" name="id" value=""></input>
    <table width="100%">   
    <tr>
        <td colspan="2" class="label"  style="display: none;"><br/><span class="STYLE4" id="mainTitle">網址檢測管理</span></td>        
      </tr>  
      <tr>
	  <td  valign="top" >
	  <table width="100%" height="100%" class="table_border2">
	  <tr>
        <td width="120"  align="right" class="label">名稱:</td>
        <td class="td_border">
        <div class="inputOver">
        	<input name="name"  type="text" id="name" value=""  style="width:100%"/>
        	</div>
        </td>
      </tr>
      <tr>
        <td width="120"  align="right" class="label">檢測方式:</td>
        <td class="td_border">
	    <div id="optionsDiv" style="float:left;width:100%;height:100%;border-bottom:1px dashed #ccc;">
        <ul>
        <li>
        <input class="typeInput" id="type" type="radio" name="type" value="ping" checked="checked"/>
        <a class="tooltip type_ping" style="font-weight:normal;" title="使用HTTP請求讀取響應碼，當不選擇HTTP請求配置時將不帶任何屬性請求。"  href="javascript:void(0);">Ping</a>
        </li>
        <li>
        <input class="typeInput" id="type" type="radio" name="type" value="source"/>
        <a class="tooltip type_source" style="font-weight:normal;" title="抓取到網頁內容後檢測是否包含異常文本（如反爬蟲驗證碼輸入提示）"  href="javascript:void(0);">網頁內容</a>
        </li>
        <li style="width:120px;">
        <input class="typeInput" id="type" type="radio" name="type" value="rules"/>
        <a class="tooltip type_rules" style="font-weight:normal;" title="使用采集規則去匹配網頁內容，當不選擇HTTP請求配置時會默認使用站點的HTTP請求配置。"  href="javascript:void(0);">采集規則檢測</a>
        </li>
        </ul>
        </div>
        
        <table id="optionTable" style="width:100%;">
        	<tr style="width:100%;">
	        	<td nowrap="nowrap"  width="100"  align="right" >
	        	</td>
	        	<td  style="width:100%;"   align="left" colspan="3" nowrap>
	        	錯誤的定義
	        	</td>
        	</tr>
        	<tr class="pingOption" style="width:100%;">
	        	<td nowrap="nowrap"  width="100"  align="right" >
	        	<a class="tooltip" href="javascript:void(0);" title="HTTP請求返回的響應碼為指定值時（如：404）表示檢測到錯誤" style="font-weight:normal;">響應碼：</a>
	        	</td>
	        	<td  style="width:100%;"   align="left" colspan="3" nowrap>
	        	<input name="definitionErrorResponseCode"  type="text" id="definitionErrorResponseCode" value="404"  style="width:200px"/>
	        	</td>
        	</tr>
        	<tr class="sourceOption" style="display:none;width:100%;">
	        	<td nowrap="nowrap"  width="100"  align="right" >
	        	<a class="tooltip" href="javascript:void(0);" title="抓取到網頁內容後檢測是否包含異常文本（如反爬蟲驗證碼輸入提示）" style="font-weight:normal;">網頁源代碼：</a>
	        	</td>
	        	<td  style="width:100%;"   align="left" colspan="3" nowrap>
	        	<div>
	        		<div style="width: 690px;">
	        			<div>
		       			<select name="sourceContain" id="sourceContain" >
							<option value="true">包含</option>
							<option value="false">不包含</option>
						</select>
						開啟正則<input name="sourceContainIsRegex" type="checkbox" id="sourceContainIsRegex" value="true" >
		       		 	<input name="sourceContainText"  type="text" id="sourceContainText" value=""  style="width:200px"/>
		       		 	</div>
	        		</div>
				</div>
	        	</td>
        	</tr>
        	<tr class="rulesOption" style="display:none;width:100%;">
	        	<td nowrap="nowrap"  width="100"  align="right" >
	        	<a class="tooltip" href="javascript:void(0);" title="網址匹配到的記錄條數小於指定值時表示檢測到錯誤" style="font-weight:normal;">記錄數小於：</a>
	        	</td>
	        	<td  style="width:100%;"   align="left" colspan="3" nowrap>
	        	<input name="definitionErrorCount"  type="text" id="definitionErrorCount" value="1"  style="width:200px"/>
	        	</td>
        	</tr>
        	<tr class="rulesOption" style="display:none;width:100%;">
	        	<td nowrap="nowrap"  width="100"  align="right" >
	        	<a class="tooltip" href="javascript:void(0);" title="指定需要檢測的采集規則版本，驗證標簽匹配到的數據是否滿足條件，不滿足條件時表示檢測到錯誤" style="font-weight:normal;">采集規則版本：</a>
	        	</td>
	        	<td  style="width:100%;"   align="left" colspan="3" nowrap>
	        	<select id="crawlRulesVerId" name="crawlRulesVerId" style="width:160px;">
		          	<option value=""></option>
		       	</select>
	        	</td>
        	</tr>
        	<tr class="rulesOption" style="display:none;width:100%;">
	        	<td nowrap="nowrap"  width="100"  align="right" >
	        	匹配規則：
	        	</td>
	        	<td  style="width:100%;"   align="left" colspan="3" nowrap>
	        	<div class="definitionErrorRulesDiv">
	        		<div id="definitionErrorRulesDiv1" class="definitionErrorRules" style="width: 690px;">
	        			<div class="definitionErrorRulesCondition" style="height: 25px; margin-top: 6px;float: left;width: 100px;">
	        			<input type="radio" name="cus_condition1" value="or" disabled="disabled">OR <input type="radio" name="cus_condition1" value="and" checked="checked"  disabled="disabled">AND
	        			</div>
	        			<div class="definitionErrorRulesLeft">
	        			<select id="cus_label" name="cus_label" style="width:160px;">
		          			<option value="" selected>選擇標簽</option>
		       			</select>
		       			<select name="cus_contain" id="cus_contain" >
							<option value="Y">包含</option>
							<option value="N">不包含</option>
						</select>
						開啟正則<input name="cus_regex" type="checkbox" id="cus_regex" value="true" >
		       		 	<input name="cus_data"  type="text" id="cus_data" value=""  style="width:200px"/>
		       		 	</div>
		       		 	
		       		 	<div class="addLabel" style="margin-top: 3px;">
						<a class="addLabelDiv" href="javascript:void(0);">+</a>
						</div>
	        		</div>
		        	
				</div>
	        	</td>
	        	
        	</tr>
        </table>
        
        </td>
      </tr>
	  
      <tr>
        <td width="120"  align="right" class="label"><a class="tooltip" href="javascript:void(0);" title="當超過允許的錯誤次數時才會調用發布規則。" >允許的錯誤次數:</a></td>
        <td class="td_border">
        <input name="errorTimesAllowed" type="text" id="errorTimesAllowed" value="0" width="100">
        </td>
      </tr>
      <tr>
        <td width="120"  align="right" class="label">錯誤處理:</td>
        <td class="td_border">
	     	<input class="optionInput" name="isDeploy" type="checkbox" id="isDeploy" value="true">
			<a class="tooltip" style="font-weight:normal;" title="調用發布規則，可以在發布規則中通過 '${ERROR_REPORT}' 來讀取錯誤報告"  href="javascript:void(0);">調用發布規則</a>
	        
	        <input  class="optionInput" name="isChangeUrlStatus" type="checkbox" id="isChangeUrlStatus" value="true" >
        	<a class="tooltip" style="font-weight:normal;" title="當檢測的網址發現錯誤時，改變網址狀態。如改變網址狀態為-44會停止網址的采集。"  href="javascript:void(0);">更新網址狀態</a>
        	
        	<input name="isTriggerException" type="checkbox" id="isTriggerException" value="true">
        	<a class="tooltip" style="font-weight:normal;" title="當檢測到網頁內容錯誤時，對當前網頁進行重試抓取。"  href="javascript:void(0);">觸發抓取異常</a>
        	
        	<input id="isSave" type="checkbox" name="isSave" value="true"/>保存檢測結果
        	
	        <table >
	        	<tr id="isDeploy_option" style="display:none;width:100%;">
		        	<td nowrap="nowrap"  width="100"  align="right" >
		        	發布規則：
		        	</td>
		        	<td  style="width:100%;"   align="left" colspan="3" nowrap>
		        	<select id="deployId" name="deployId" style="width:160px;"></select>
		        	</td>
	        	</tr>
	        	<tr id="isChangeUrlStatus_option" style="display:none;width:100%;">
			       	<td nowrap="nowrap"  width="100"  align="right" >
	       		 	網址狀態：
	       		 	</td>
			        <td  style="width:100%;"   align="left" colspan="3" nowrap>
	       		 	<input name="changeUrlStatus"  type="text" id="changeUrlStatus" value="-44"  style="width:60px"/>
		        	</td>
        		</tr>
	        </table>
        </td>
      </tr>
      <tr>
        <td ></td>
        <td class="td_border">
       	 	<input class="createBtn" type="button" value="添加">
			<input class="removeBtn" type="button" value="刪除">
			<input class="updateBtn" type="button" value="更新">
        </td>
      </tr>
      <tr>
      <td ></td>
      <td align="left" style="padding:0px 5px 5px 5px;color:red;" >
      <br/>
      </td>
      </tr>
       <tr>
			<td colspan="2">
				<table id="urlCheckTable"  width="100%" align="center" class="table_border2 tableList" style="border:1px solid #CCCCCC;border-collapse:collapse;background-color: #FFFFFF;">
					<tr>
						<td width="5%" nowrap bgcolor="whiteSmoke">&nbsp;選擇</td>
						<td width="10%" nowrap bgcolor="whiteSmoke">&nbsp;&nbsp;&nbsp;名稱</td>
						<td width="10%" nowrap bgcolor="whiteSmoke">檢測方式</td>
						<td width="5%" nowrap bgcolor="whiteSmoke">保存檢測結果</td>
						<td width="5%" nowrap bgcolor="whiteSmoke">錯誤處理</td>
						<td width="10%" nowrap bgcolor="whiteSmoke">更新時間</td>
					</tr>
				</table>
			</td>
		</tr>
	  </table>
	  
	  </td>
	  </tr>
	  
  </table>
  		 </form>
  <script type="text/javascript">
  $(document).ready(function() { 
	  var initFun=function(){
		  var formId;
		  var tableId;
		  if (!loadConfig) {
			  var id=$(document).find("#urlCheckForm").parents('.ui-tabs-panel').attr("id");
			  formId=id+" #urlCheckForm";
			  tableId=id+" #urlCheckTable";
		  }else{
				formId="config #urlCheckForm";
				tableId="config #urlCheckTable";
		  }
		  
			  var urlcheck=new urlcheckFun({
				  formId:formId,
				  tableId:tableId,
				  index:1,
				  webCrawlerId:webCrawlerId,
				  siteId:siteId,
				  jsonData:new Array(),
				  definitionErrorRules:null
			  });
			
			fillDeploy(urlcheck.v.formId, "deployId", false)
			fillRulesVer(urlcheck.v.formId, "crawlRulesVerId", true);
			
			urlcheck.fn.init();
			urlcheck.fn.query();
			
			poshytip('.tooltip');
		};
	  
		var initLoading=setInterval(function(){
			if(typeof urlcheck != 'undefined'){
				clearInterval(initLoading);
				initFun();
			}
		},500);
	});
  </script>
  </body>
</html>

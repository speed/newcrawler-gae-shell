function sessionManagerFun(option){var sessionManager={fn:{init:function(){fillHttpRequest(obj.v.formId,"httpRequestId",true,"sync_count");$("#"+obj.v.formId).find(".test").click(function(){obj.fn.test()});$("#"+obj.v.formId).find(".create").click(function(){$("#"+obj.v.formId).find("#cookies").hide();obj.fn.create()});$("#"+obj.v.formId).find(".remove").click(function(){$("#"+obj.v.formId).find("#cookies").hide();obj.fn.remove()});$("#"+obj.v.formId).find(".update").click(function(){$("#"+obj.v.formId).find("#cookies").hide();obj.fn.update()});$("#"+obj.v.formId).find(".addLabelDiv").click(function(){$("#"+obj.v.formId).find("#cookies").hide();obj.fn.addSessionRulesDiv()});initConfigBox()},test:function(){var sessionUrlJson=obj.fn.readSessionUrl();jsonrpc.sessionService.test(function(result,exception,profile){if(result){$("#"+obj.v.formId).find("#cookies").show();$("#"+obj.v.formId).find("#cookies textarea").val(result);$("#"+obj.v.formId).find("#message").text(nc.i18n("res.login.test.success"))}else{$("#"+obj.v.formId).find("#message").text(nc.i18n("res.login.test.failure"))}},obj.v.webCrawlerId,sessionUrlJson)},query:function(callback){moveAllTr(obj.v.tableId);queryLoading(obj.v.tableId);jsonrpc.sessionService.query(function(result,exception,profile){moveAllTr(obj.v.tableId);var data=result;data=eval(data);obj.v.jsonData=data;var key=""+obj.v.webCrawlerId;sessionMap.put(key,data);for(var i in data){if(isNaN(i)){continue}var id=data[i]["id"];var name=data[i]["name"];var sessionUrlJson=data[i]["sessionUrlJson"];obj.fn.addRow(id,name,sessionUrlJson)}$("#"+obj.v.tableId).find(".editSession").click(function(){obj.fn.edit($(this).val())});removeLoading($("#"+obj.v.formId));if(callback){callback()}},obj.v.webCrawlerId)},edit:function(id){var data=obj.v.jsonData;for(var i in data){if(isNaN(i)){continue}if(id!=data[i]["id"]){continue}var name=data[i]["name"];var sessionUrlJson=data[i]["sessionUrlJson"];$("#"+obj.v.formId).find("#id").val(id);$("#"+obj.v.formId).find("#name").val(name);obj.fn.writeSessionUrl(sessionUrlJson);return}},create:function(){$(".sessionRules").each(function(index){$(this).find("input[name='id']").val("")});var name=$("#"+obj.v.formId).find("#name").val();var sessionUrlJson=obj.fn.readSessionUrl();showLoading($("#"+obj.v.formId));jsonrpc.sessionService.save(function(result,exception,profile){removeLoading($("#"+obj.v.formId));if(exception){return}var id=result;if(!isNum(id)){showInfo(nc.i18n("res.create.failure"));return}showInfo(nc.i18n("res.create.success"));obj.fn.query();updateSelect(id,name,"httpRequestId")},obj.v.webCrawlerId,null,name,sessionUrlJson)},update:function(){var id=$("#"+obj.v.formId).find("#id").val();if(id==null||id.length==0){showInfo(nc.i18n("res.select"));return}var name=$("#"+obj.v.formId).find("#name").val();var sessionUrlJson=obj.fn.readSessionUrl();showLoading($("#"+obj.v.formId));jsonrpc.sessionService.save(function(result,exception,profile){removeLoading($("#"+obj.v.formId));if(exception){return}id=result;if(!isNum(id)){showInfo(nc.i18n("res.update.failure"));return}showInfo(nc.i18n("res.update.success"));obj.fn.query();updateSelect(id,name,"httpRequestId")},obj.v.webCrawlerId,id,name,sessionUrlJson)},remove:function(){var id=getRadio(obj.v.formId,"sessionId");if(id==null||id.length==0){showInfo(nc.i18n("res.select"));return false}if(!confirm(nc.i18n("res.remove.confirm"))){return}showLoading($("#"+obj.v.formId));jsonrpc.sessionService.remove(function(result,exception,profile){removeLoading($("#"+obj.v.formId));if(exception){return}var msg=result;if(msg){showInfo(nc.i18n("res.remove.success"));obj.fn.query();removeSelect(id,"httpRequestId");return}showInfo(nc.i18n("res.remove.failure"))},obj.v.webCrawlerId,id)},addRow:function(id,name,sessionUrlJson){var newTr="<tr class='simplehighlight'>";newTr+='<td nowrap>&nbsp;<input type="radio" name="sessionId" id="sessionId" value="'+id+'" class="editSession"/></td>';newTr+="<td nowrap>&nbsp;&nbsp;&nbsp;"+name+"</td>";newTr+='<td nowrap class="sessionUrl"></td>';newTr+="</tr>";var newTrObj=$(newTr);var data=eval(sessionUrlJson);for(var i in data){if(isNaN(i)){continue}var url=data[i]["url"];var createDate=data[i]["createDate"];newTrObj.find(".sessionUrl").append("<div class='simplehighlight' style='line-height: 25px; padding: 5px;'><span>"+url+"</span><span style='padding-left: 15px; color: #7B90C9;'>"+createDate+"</span></div>")}newTrObj.find(".sessionUrl").find(">div:odd").css("background","#FFFFFF");newTrObj.find(".sessionUrl").find(">div:even").css("background","rgb(247, 247, 247)");newTrObj.appendTo("#"+obj.v.tableId);$("#"+obj.v.tableId).find("tr:odd").css("background","#FFFFFF");$("#"+obj.v.tableId).find("tr:even").css("background","rgb(247, 247, 247)");$("#"+obj.v.tableId).find(".simplehighlight").hover(function(){$(this).children().addClass("datahighlight");$(this).find("textarea").addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight");$(this).find("textarea").removeClass("datahighlight")})},readSessionUrl:function(){var sessionUrls=new Array();$(".sessionRules").each(function(index){var id=$(this).find("input[name='id']").val();var httpRequestId=$(this).find("select[name='httpRequestId']").val();var url=$(this).find("input[name='url']").val();var params=$(this).find("input[name='params']").val();var sortIndex=$(this).find("input[name='sortIndex']").val();if(url!=null&&url!=""){sessionUrls.push({id:id,httpRequestId:httpRequestId,url:url,params:params,sortIndex:sortIndex})}});var sessionUrlJson=JSON.stringify(sessionUrls);return sessionUrlJson},writeSessionUrl:function(sessionUrlJson){var data=eval(sessionUrlJson);for(var i in data){if(isNaN(i)){continue}var id=data[i]["id"];var httpRequestId=data[i]["httpRequestId"];var url=data[i]["url"];var params=data[i]["params"];var sortIndex=data[i]["sortIndex"];var newDiv=null;if(i==0){newDiv=$("#"+obj.v.formId).find("#sessionRulesDiv1")}else{newDiv=obj.fn.addSessionRulesDiv()}newDiv.find("input[name='id']").val(id);newDiv.find("select[name='httpRequestId']").val(httpRequestId);newDiv.find("input[name='url']").val(url);newDiv.find("input[name='params']").val(params);newDiv.find("input[name='sortIndex']").val(sortIndex)}},addSessionRulesDiv:function(){var n=obj.v.index;obj.v.index=n+1;var newDiv=$("#"+obj.v.formId).find("#sessionRulesDiv"+n).clone();newDiv.attr("id","sessionRulesDiv"+obj.v.index);newDiv.find("input[name='url']").val("");newDiv.find("input[name='params']").val("");newDiv.find("input[name='sortIndex']").val("0");newDiv.find("select[name='httpRequestId']").val("");newDiv.find("input[name='id']").val("");newDiv.appendTo("#"+obj.v.formId+" .sessionRulesDiv");$("#"+obj.v.formId).find("#sessionRulesDiv"+n).find(".addLabel").remove();$("#"+obj.v.formId).find(".addLabelDiv").click(function(){obj.fn.addSessionRulesDiv()});$("#"+obj.v.formId+" .sessionRulesDiv").find(">div:odd").css("background","#FFFFFF");$("#"+obj.v.formId+" .sessionRulesDiv").find(">div:odd").find("tr").css("background","#FFFFFF");$("#"+obj.v.formId+" .sessionRulesDiv").find(">div:even").css("background","rgb(247, 247, 247)");$("#"+obj.v.formId+" .sessionRulesDiv").find(">div:even").find("tr").css("background","rgb(247, 247, 247)");initConfigBox();poshytip(".tooltip");return newDiv},}};var obj=this;obj.fn=sessionManager.fn;obj.v=option}var sessionManager=new sessionManagerFun();
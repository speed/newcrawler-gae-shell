var permissions={v:{formId:"permissionsForm",mainTableId:"permissionsTable",properties:null},fn:{init:function(){permissions.v.properties=$("#"+permissions.v.formId).find("#properties").val();showLoading($("#"+permissions.v.mainTableId));jsonrpc.userGroupRpcService.query(function(result,exception,profile){if(exception){removeLoading($("#"+permissions.v.mainTableId));return}var userGroupData=result;userGroupData=eval(userGroupData);for(var i in userGroupData){if(isNaN(i)){continue}var id=userGroupData[i]["id"];var description=userGroupData[i]["description"];addOption(permissions.v.formId,"userGroupId",description,id,false)}removeLoading($("#"+permissions.v.mainTableId))});jsonrpc.moduleRpcService.query(function(result,exception,profile){if(exception){removeLoading($("#"+permissions.v.mainTableId));return}var modulesData=result;modulesData=eval(modulesData);var index=0;for(var i in modulesData){if(isNaN(i)){continue}var id=modulesData[i]["id"];var name=modulesData[i]["name"];var description=modulesData[i]["description"];if(description!=null&&description!=""){description="("+description+")"}else{description=""}index++;$("#"+permissions.v.formId).find("#modulesDiv ul").append("<li><span style='width: 22px; float: left; padding-top: 1.5px;'>"+index+'.</span><input name="module" type="checkbox" id="module" value="'+id+'"/>'+name+description+"</li>")}permissions.fn.initCheckbox()})},selectAll:function(e,d){var f=$("#"+permissions.v.formId).find(":checkbox[name="+d+"]");for(var b=0,a=f.length;b<a;b++){f[b].checked=e.checked;if(f[b].checked){$(f[b]).parent("li").removeClass("notPermissions")}else{$(f[b]).parent("li").addClass("notPermissions")}}},initCheckbox:function(){var d=$("#"+permissions.v.formId).find(":checkbox[name=module]");for(var b=0,a=d.length;b<a;b++){d[b].checked=false;$(d[b]).parent("li").addClass("notPermissions");$(d[b]).click(function(){if(this.checked){$(this).parent("li").removeClass("notPermissions")}else{$(this).parent("li").addClass("notPermissions")}})}},query:function(){$("#"+permissions.v.formId).find(":checkbox[name=all]").attr("checked",false);permissions.fn.initCheckbox();var userGroupId=$("#"+permissions.v.formId).find("#userGroupId").val();showLoading($("#"+permissions.v.mainTableId));jsonrpc.permissionsRpcService.query(function(result,exception,profile){if(exception){removeLoading($("#"+permissions.v.mainTableId));return}var mappingData=result;mappingData=eval(mappingData);for(var i in mappingData){if(isNaN(i)){continue}var moduleId=mappingData[i]["moduleId"];var moduleObj=$("#"+permissions.v.formId).find(":checkbox[name=module][value='"+moduleId+"']");moduleObj[0].checked=true}$("#"+permissions.v.formId).find(":checkbox[name=module]").each(function(){if(this.checked){$(this).parent("li").removeClass("notPermissions")}else{$(this).parent("li").addClass("notPermissions")}});removeLoading($("#"+permissions.v.mainTableId))},userGroupId);if(userGroupId==null||userGroupId===""){$("#"+permissions.v.formId).find("#properties").val(permissions.v.properties)}else{showLoading($("#"+permissions.v.mainTableId));jsonrpc.permissionsRpcService.queryOtherPermissions(function(result,exception,profile){if(exception){removeLoading($("#"+permissions.v.mainTableId));return}var properties=result;$("#"+permissions.v.formId).find("#properties").val(properties);removeLoading($("#"+permissions.v.mainTableId))},userGroupId)}},save:function(){var g=$("#"+permissions.v.formId).find("#userGroupId").val();var e=$("#"+permissions.v.formId).find("#properties").val();var b=new Array();var h=$("#"+permissions.v.formId).find(":checkbox[name=module]");for(var d=0,a=h.length;d<a;d++){if(h[d].checked){var f=h[d].value;b.push(f)}}showLoading($("#"+permissions.v.mainTableId));jsonrpc.permissionsRpcService.save(function(c,i,j){if(i){removeLoading($("#"+permissions.v.mainTableId));return}var k=c;if(k){showInfo("设置权限成功。")}else{showInfo("设置权限失败。")}removeLoading($("#"+permissions.v.mainTableId))},g,b,e)}}};
var crawlAlert={v:{tableId:"crawlAlertTable",formId:"crawlAlertForm",webCrawlerId:null,siteId:null,urlQueueOutChart:null,dataCountChart:null,urlExceptionChart:null,rulesErrorChart:null},fn:{init:function(){if(crawlAlert.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}jsonrpc.crawlAlertService.query(function(result,exception,profile){removeLoading(jQuery("#"+crawlAlert.v.formId));var urlQueueOut="";var dataCount="";var urlException="";var rulesError="";var emailNoticeId="";var id="";var data=result;if(data!=null){data=eval("("+data+")");id=data.id;urlQueueOut=data.urlQueueOut;dataCount=data.dataCount;urlException=data.urlException;rulesError=data.rulesError;emailNoticeId=data.emailNoticeId;if(urlQueueOut==null){urlQueueOut=""}if(dataCount==null){dataCount=""}if(urlException==null){urlException=""}if(rulesError==null){rulesError=""}if(emailNoticeId==null){emailNoticeId=""}}jQuery("#"+crawlAlert.v.formId+" #id").val(id);jQuery("#"+crawlAlert.v.formId+" #urlQueueOut").val(urlQueueOut);jQuery("#"+crawlAlert.v.formId+" #dataCount").val(dataCount);jQuery("#"+crawlAlert.v.formId+" #urlException").val(urlException);jQuery("#"+crawlAlert.v.formId+" #rulesError").val(rulesError);jQuery("#"+crawlAlert.v.formId+" #emailNoticeId").val(emailNoticeId);jsonrpc.crawlDataLogService.queryFinished(function(result,exception,profile){if(exception){return}var urlQueueOutData=new Array();var dataCountData=new Array();var urlExceptionData=new Array();var rulesErrorData=new Array();var categories=new Array();var data=result;data=eval(data);for(var i in data){if(isNaN(i)){continue}urlQueueOutData.unshift(data[i]["urlQueueOut"]);dataCountData.unshift(data[i]["dataCount"]);urlExceptionData.unshift(data[i]["urlException"]);rulesErrorData.unshift(data[i]["rulesError"]);categories.unshift(data[i]["finishDate"])}if(urlQueueOut==""){urlQueueOut=0}if(dataCount==""){dataCount=0}if(urlException==""){urlException=0}if(rulesError==""){rulesError=0}crawlAlert.v.urlQueueOutChart=crawlAlert.fn.initChart("crawlAlertChart_urlQueueOut",nc.i18n("res.label.urlQueueOut.monitor"),nc.i18n("res.label.urlQueueOut")," Link",urlQueueOut,0,categories,urlQueueOutData,0);crawlAlert.v.dataCountChart=crawlAlert.fn.initChart("crawlAlertChart_dataCount",nc.i18n("res.label.dataCount.monitor"),nc.i18n("res.label.dataCount"),"",dataCount,0,categories,dataCountData,2);crawlAlert.v.urlExceptionChart=crawlAlert.fn.initChart("crawlAlertChart_urlException",nc.i18n("res.label.urlException.monitor"),nc.i18n("res.label.urlException")," Link",9999999,urlException,categories,urlExceptionData,8);crawlAlert.v.rulesErrorChart=crawlAlert.fn.initChart("crawlAlertChart_rulesError",nc.i18n("res.label.rulesError.monitor"),nc.i18n("res.label.rulesError")," Link",9999999,rulesError,categories,rulesErrorData,3)},crawlAlert.v.webCrawlerId,crawlAlert.v.siteId)},crawlAlert.v.webCrawlerId,crawlAlert.v.siteId);jQuery("#"+crawlAlert.v.formId+" .save").click(function(){crawlAlert.fn.save()})},save:function(){var f=jQuery("#"+crawlAlert.v.formId+" #id").val();var d=jQuery("#"+crawlAlert.v.formId+" #urlQueueOut").val();var c=jQuery("#"+crawlAlert.v.formId+" #dataCount").val();var e=jQuery("#"+crawlAlert.v.formId+" #urlException").val();var b=jQuery("#"+crawlAlert.v.formId+" #rulesError").val();var a=jQuery("#"+crawlAlert.v.formId+" #emailNoticeId").val();showLoading(jQuery("#"+crawlAlert.v.formId));jsonrpc.crawlAlertService.save(function(g,h,i){removeLoading(jQuery("#"+crawlAlert.v.formId));if(h){return}var j=g;if(isNum(g)){crawlAlert.v.urlQueueOutChart=crawlAlert.fn.updateChart(crawlAlert.v.urlQueueOutChart,d,0);crawlAlert.v.dataCountChart=crawlAlert.fn.updateChart(crawlAlert.v.dataCountChart,c,0);crawlAlert.v.urlExceptionChart=crawlAlert.fn.updateChart(crawlAlert.v.urlExceptionChart,9999999,e);crawlAlert.v.rulesErrorChart=crawlAlert.fn.updateChart(crawlAlert.v.rulesErrorChart,9999999,b);jQuery("#"+crawlAlert.v.formId+" #id").val(g);showInfo(nc.i18n("res.save.success"))}else{showInfo(nc.i18n("res.save.failure"))}},crawlAlert.v.webCrawlerId,f,crawlAlert.v.siteId,d,c,e,b,a)},updateChart:function(b,e,d){if(e!=null&&e!=""){e=parseInt(e)}if(d!=null&&d!=""){d=parseInt(d)}var a=b.options;var c=a.yAxis[0].plotBands;c[0].from=e;c[0].to=d;b=new Highcharts.Chart(a);return b},initChart:function(b,g,a,j,h,i,e,c,d){var f=new Highcharts.Chart({chart:{renderTo:b},title:{text:g,x:-20},xAxis:{categories:e},yAxis:{plotBands:[{from:h,to:i,color:"rgba(255, 0, 0, 0.22)",zIndex:1}]},tooltip:{valueSuffix:j},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:[{lineWidth:1.5,name:a,data:c,zIndex:2,lineColor:Highcharts.getOptions().colors[d],marker:{fillColor:"white",lineWidth:1.5,lineColor:Highcharts.getOptions().colors[d]}}]});return f}}};
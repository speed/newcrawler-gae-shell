var moduleList={v:{formId:"moduleForm",searchFormId:"moduleSearchForm",tableId:"moduleListTable",mainTableId:"moduleTable",jsonData:new Array(),PER_PAGE_ITEMS:20,ITEMS_COUNT:0,cur_page:0},fn:{refresh:function(){moduleList.fn.query(moduleList.v.cur_page);moduleList.fn.updateCount();moduleList.fn.initPagination(moduleList.v.cur_page)},syncModules:function(){showInfo("正在同步模块。");showLoading($("#"+moduleList.v.mainTableId));jsonrpc.moduleRpcService.syncModules(function(a,b,c){if(b){removeLoading($("#"+moduleList.v.mainTableId));return}showInfo("模块同步成功。");moduleList.fn.refresh();removeLoading($("#"+moduleList.v.mainTableId))})},removeAll:function(){showLoading($("#"+moduleList.v.mainTableId));jsonrpc.moduleRpcService.removeAll(function(a,b,c){if(b){removeLoading($("#"+moduleList.v.mainTableId));return}showInfo("删除所有模块成功。");moduleList.fn.refresh();removeLoading($("#"+moduleList.v.mainTableId))})},create:function(){var a=$("#"+moduleList.v.formId).find("#name").val();var b=$("#"+moduleList.v.formId).find("#description").val();showLoading($("#"+moduleList.v.mainTableId));jsonrpc.moduleRpcService.create(function(c,d,e){if(d){removeLoading($("#"+moduleList.v.mainTableId));return}var f=c;if(!isNum(f)){showInfo("添加模块失败。");return}showInfo("添加模块成功。");removeLoading($("#"+moduleList.v.mainTableId));moduleList.fn.refresh()},a,b)},edit:function(e){var d=moduleList.v.jsonData;for(var b in d){if(isNaN(b)){continue}if(e!=d[b]["id"]){continue}var e=d[b]["id"];var a=d[b]["name"];var c=d[b]["description"];$("#"+moduleList.v.formId).find("#id").val(e);$("#"+moduleList.v.formId).find("#name").val(a);$("#"+moduleList.v.formId).find("#description").val(c)}},remove:function(a){if(!confirm("删除之后将无法恢复，你确定要删除吗？")){return}showLoading($("#"+moduleList.v.mainTableId));jsonrpc.moduleRpcService.remove(function(b,c,d){if(c){removeLoading($("#"+moduleList.v.mainTableId));return}var e=b;if(!e){showInfo("删除模块失败。");return}showInfo("删除模块成功。");moduleList.fn.query(moduleList.v.cur_page);removeLoading($("#"+moduleList.v.mainTableId))},a)},update:function(){var c=$("#"+moduleList.v.formId).find("#id").val();if(c==null||c.length==0){showInfo("请选择一条记录。");return}var a=$("#"+moduleList.v.formId).find("#name").val();var b=$("#"+moduleList.v.formId).find("#description").val();showLoading($("#"+moduleList.v.mainTableId));jsonrpc.moduleRpcService.update(function(d,e,f){if(e){removeLoading($("#"+moduleList.v.mainTableId));return}var g=d;if(!g){showInfo("更新用户组失败。");return}showInfo("更新用户组成功。");moduleList.fn.query(moduleList.v.cur_page);removeLoading($("#"+moduleList.v.mainTableId))},c,a,b)},search:function(){var a=$("#"+accountList.v.searchFormId).find("#name").val();var b=jsonrpc.moduleRpcService.query(a);moduleList.fn.showData(b);$("#"+accountList.v.mainTableId).find("#Pagination").html("")},statistic:function(){var a=jsonrpc.moduleRpcService.statistic();if(a){showInfo("已启动后台统计任务。")}else{showInfo("执行统计任务失败。")}},query:function(a){var b=a*moduleList.v.PER_PAGE_ITEMS;moveAllTr(moduleList.v.tableId);queryLoading(moduleList.v.tableId);jsonrpc.moduleRpcService.query(function(c,d,e){removeLoading($("#"+moduleList.v.mainTableId));if(d){return}moveAllTr(moduleList.v.tableId);var f=c;moduleList.fn.showData(f)},b,moduleList.v.PER_PAGE_ITEMS)},showData:function(data){data=eval(data);moduleList.v.jsonData=data;var index=1;for(var i in data){if(isNaN(i)){continue}var id=data[i]["id"];var name=data[i]["name"];var description=data[i]["description"];var status=data[i]["status"];var createDate=data[i]["createDate"];moduleList.fn.addRow(index,id,name,description,status,createDate);index++}$("#"+moduleList.v.tableId).find("tr:odd").css("background","#FFFFFF");$("#"+moduleList.v.tableId).find("tr:even").css("background","rgb(247, 247, 247)");$("#"+moduleList.v.tableId).find(".simplehighlight").hover(function(){$(this).children().addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight")})},addRow:function(d,g,c,f,b,e){var a="<tr class='simplehighlight'>";a+="<td nowrap>"+d+"</td>";a+="<td nowrap>"+c+"</td>";a+="<td nowrap>&nbsp; "+f+"</td>";a+="<td nowrap>&nbsp; "+b+"</td>";a+="<td nowrap>&nbsp; "+e+"</td>";a+='<td nowrap style="text-align:center"> <a href="javascript:void(0)" onclick="moduleList.fn.edit('+g+')" >编辑</a> | <a href="javascript:void(0)" onclick="moduleList.fn.remove('+g+')" >删除</a></td>';a+="</tr>";$(a).appendTo("#"+moduleList.v.tableId)},updateCount:function(){moduleList.v.ITEMS_COUNT=jsonrpc.moduleRpcService.count();$("#"+moduleList.v.mainTableId).find("#MODULE_COUNT").html(moduleList.v.ITEMS_COUNT)},initPagination:function(a){$("#"+moduleList.v.mainTableId).find("#Pagination").pagination(moduleList.v.ITEMS_COUNT,{num_edge_entries:2,num_display_entries:8,current_page:a,callback:moduleList.fn.pageselectCallback,items_per_page:moduleList.v.PER_PAGE_ITEMS,prev_text:"上一页",next_text:"下一页"})},pageselectCallback:function(a,b){moduleList.v.cur_page=a;moduleList.fn.query(moduleList.v.cur_page);return false}}};$(document).ready(function(){moduleList.fn.refresh()});
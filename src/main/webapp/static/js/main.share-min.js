var share={v:{PER_PAGE_ITEMS:10,ITEMS_COUNT:0,cur_page:0,formId:"shareForm"},fn:{init:function(){share.v.cur_page=0;share.v.ITEMS_COUNT=0;var a={beforeSubmit:share.fn.showRequest,success:share.fn.showResponse,clearForm:false,resetForm:false,dataType:"json"};$("#"+share.v.formId).ajaxForm(a);share.fn.queryUserShare()},changeType:function(a){if(a=="plugin"){$("#"+share.v.formId).find("#categroy1-div").css("display","");$("#"+share.v.formId).find("#categroy2-div").css("display","none")}else{if(a=="rules"){$("#"+share.v.formId).find("#categroy1-div").css("display","none");$("#"+share.v.formId).find("#categroy2-div").css("display","")}else{$("#"+share.v.formId).find("#categroy1-div").css("display","none");$("#"+share.v.formId).find("#categroy2-div").css("display","none")}}},showRequest:function(g,a,c){var e=$("#"+share.v.formId).find("#type").val();if(e==null||e==""){showInfo(nc.i18n("res.type.select"));return false}var f=null;if(e=="plugin"){f=$("#"+share.v.formId).find("#category1").val()}else{if(e=="rules"){f=$("#"+share.v.formId).find("#category2").val()}}if(f==null||f===""){showInfo(nc.i18n("res.type.select"));return false}g.push({name:"category",value:f});var b=$("#"+share.v.formId).find("#name").val();if(b==null||b==""){showInfo(nc.i18n("res.name.null"));return false}var d=$("#"+share.v.formId).find("#fileToUpload").val();if(d==null||d==""){showInfo(nc.i18n("res.selectFile"));return false}$("#"+share.v.formId).find("#msgOutput").html("Uploading...")},showResponse:function(a,b){setTimeout(function(){share.fn.callback(a)},3000)},callback:function(a){if(a.code=="200"){$("#"+share.v.formId).find("#msgOutput").html(a.message);share.fn.queryUserShare()}else{if(a.code=="401"){showInfo(a.message)}else{if(a.code=="501"){$("#"+share.v.formId).find("#msgOutput").html(a.message)}else{$("#"+share.v.formId).find("#msgOutput").html(nc.i18n("res.file.upload.failure"));$("#trace-box").find("#trace").html(a.message);$("#trace-box").dialog("open")}}}},refresh:function(){share.fn.updateCount()},statistic:function(){jsonrpc.shareService.statistic(function(a,b,c){if(b){return}var d=a;if(d){showInfo(nc.i18n("res.background.statistics"))}else{showInfo(nc.i18n("res.background.statistics.failure"))}})},updateCount:function(){jsonrpc.shareService.count(function(a,b,c){if(b){return}share.v.ITEMS_COUNT=a;$("#shareTable").find("#ITEM_COUNT").html(share.v.ITEMS_COUNT);share.fn.query(share.v.cur_page);share.fn.initPagination(share.v.cur_page)})},pageselectCallback:function(a,b){share.v.cur_page=a;showLoading($("#shareTable"));share.fn.query(share.v.cur_page);return false},addRow:function(n,i,c,g,a,f,j,d,b,m,h){if(m==null){m=0}if(h==null){h=0}var e=getSelectText(share.v.formId,"type",j);var l="";if(j=="plugin"){l=getSelectText(share.v.formId,"category1",d)}else{if(j=="rules"){l=getSelectText(share.v.formId,"category2",d)}}var k="<tr class='simplehighlight'>";k+="<td>  "+b+"</td>";k+="<td>"+e+" > "+l+"</td>";k+="<td>"+g+"</td>";k+="<td>"+a+"</td>";k+="<td>"+m+"</td>";k+="<td>"+h+"</td>";if(i=="userShareList"){k+='<td><a href="'+f+'" >'+nc.i18n("res.download")+"</a></td>"}else{k+='<td><a href="'+f+'" >'+nc.i18n("res.download")+'</a> | <a href="javascript:void(0)" onclick="share.fn.openCommentBox(\''+c+"')\">"+nc.i18n("res.comment.submit")+"</a></td>"}k+="</tr>";$(k).appendTo("#"+n);$("#shareTable").find("#"+i).find("tr:even").css("background","#EEE");$("#shareTable").find("#"+i).find("tr:odd").css("background","#FFFFFF");$("#shareTable").find(".simplehighlight").hover(function(){$(this).children().addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight")})},queryUserShare:function(){moveAllTr("userShareTabel");queryLoading("userShareTabel");jsonrpc.shareService.queryByUser(function(result,exception,profile){if(exception){return}moveAllTr("userShareTabel");var data=result;data=eval(data);for(var i in data){if(isNaN(i)){continue}var id=data[i]["id"];var time=data[i]["createDate"];var filename=data[i]["filename"];var downurl="../../member/file/download"+filename+"?id="+id;var type=data[i]["type"];var category=data[i]["category"];var name=data[i]["name"];var downs=data[i]["downs"];var comments=data[i]["comments"];share.fn.addRow("userShareTabel","userShareList",id,time,filename,downurl,type,category,name,downs,comments)}share.fn.refresh()})},query:function(cur_page){var startIndex=cur_page*share.v.PER_PAGE_ITEMS;moveAllTr("allShareTabel");queryLoading("allShareTabel");jsonrpc.shareService.queryAll(function(result,exception,profile){if(exception){return}var data=result;data=eval(data);moveAllTr("allShareTabel");for(var i in data){if(isNaN(i)){continue}var id=data[i]["id"];var time=data[i]["createDate"];var filename=data[i]["filename"];var downurl="../../member/file/download"+filename+"?id="+id;var type=data[i]["type"];var category=data[i]["category"];var name=data[i]["name"];var downs=data[i]["downs"];var comments=data[i]["comments"];share.fn.addRow("allShareTabel","allShareList",id,time,filename,downurl,type,category,name,downs,comments)}removeLoading($("#shareTable"))},startIndex,share.v.PER_PAGE_ITEMS)},initPagination:function(a){$("#shareTable #Pagination").pagination(share.v.ITEMS_COUNT,{num_edge_entries:2,num_display_entries:8,current_page:a,callback:share.fn.pageselectCallback,items_per_page:share.v.PER_PAGE_ITEMS,prev_text:nc.i18n("res.page.prev"),next_text:nc.i18n("res.page.next")})},openCommentBox:function(a){$("#commentForm #id").val(a);$("#commentDialogWrapper").dialog("open")},comment:function(c,b,a){showLoading($("#"+share.v.formId));jsonrpc.shareCommentService.comment(function(d,e,f){removeLoading($("#"+share.v.formId));if(e){return}var g=d;if(g){showInfo(nc.i18n("res.comment.success"));$("#commentForm #description").val("");share.fn.query(share.v.cur_page)}else{showInfo(g)}},c,b,a)}}};
function urlcheckFun(option){var urlcheck={fn:{init:function(){$("#"+obj.v.formId).find(".typeInput").click(function(){obj.fn.changeMode(this)});$("#"+obj.v.formId).find("#crawlRulesVerId").change(function(){obj.fn.changeRulesVer(this.value)});$("#"+obj.v.formId).find(".addLabelDiv").click(function(){obj.fn.addDefinitionErrorRulesDiv()});$("#"+obj.v.formId).find(".optionInput").change(function(){obj.fn.changeOption(this)});$("#"+obj.v.formId).find(".createBtn").click(function(){obj.fn.create()});$("#"+obj.v.formId).find(".removeBtn").click(function(){obj.fn.remove()});$("#"+obj.v.formId).find(".updateBtn").click(function(){obj.fn.update()})},query:function(){moveAllTr(obj.v.tableId);queryLoading(obj.v.tableId);jsonrpc.urlCheckService.query(function(result,exception,profile){if(exception){removeLoading($("#"+obj.v.formId));return}moveAllTr(obj.v.tableId);var data=result;if(data!=null&&data!=""){data=eval(data);obj.v.jsonData=data;for(var i in data){if(isNaN(i)){continue}var id=data[i]["id"];var name=data[i]["name"];var type=data[i]["type"];var isSave=data[i]["isSave"];var isDeploy=data[i]["isDeploy"];var isChangeUrlStatus=data[i]["isChangeUrlStatus"];var createDate=data[i]["updateDate"];obj.fn.addRow(id,name,type,isSave,isDeploy,isChangeUrlStatus,createDate)}}removeLoading($("#"+obj.v.formId))},obj.v.webCrawlerId,obj.v.siteId)},edit:function(id){var data=obj.v.jsonData;for(var i in data){if(isNaN(i)){continue}if(id!=data[i]["id"]){continue}$("#"+obj.v.formId).find("#id").val(id);$("#"+obj.v.formId).find("#name").val(data[i].name);if(data[i].type==3){selectCheckbox(obj.v.formId,"type","rules")}else{if(data[i].type==2){selectCheckbox(obj.v.formId,"type","source")}else{selectCheckbox(obj.v.formId,"type","ping")}}selectCheckbox(obj.v.formId,"isSave",data[i].isSave);selectCheckbox(obj.v.formId,"isDeploy",data[i].isDeploy);selectCheckbox(obj.v.formId,"isChangeUrlStatus",data[i].isChangeUrlStatus);if(data[i].isTriggerException==null||!data[i].isTriggerException){selectCheckbox(obj.v.formId,"isTriggerException","false")}else{selectCheckbox(obj.v.formId,"isTriggerException","true")}$("#"+obj.v.formId).find("#errorTimesAllowed").val(data[i].errorTimesAllowed);$("#"+obj.v.formId).find("#crawlRulesVerId").val(data[i].rulesVerId);obj.fn.changeOption($("#"+obj.v.formId).find("#isDeploy")[0]);obj.fn.changeOption($("#"+obj.v.formId).find("#isChangeUrlStatus")[0]);obj.fn.changeMode($("#"+obj.v.formId).find("#type")[0]);$("#"+obj.v.formId).find("#deployId").val(data[i].deployId);$("#"+obj.v.formId).find("#changeUrlStatus").val(data[i].changeUrlStatus);$("#"+obj.v.formId).find("#definitionErrorCount").val(data[i].definitionErrorCount);$("#"+obj.v.formId).find("#definitionErrorResponseCode").val(data[i].definitionErrorResponseCode);obj.v.definitionErrorRules=data[i].definitionErrorRules;obj.fn.changeRulesVer(data[i].rulesVerId,function(){if(obj.v.index!=1){obj.v.index=1;$(".definitionErrorRules").each(function(index){if(this.id=="definitionErrorRulesDiv1"){$("#"+obj.v.formId).find(".addLabel").clone().appendTo("#"+obj.v.formId+" #"+this.id)}else{$(this).remove()}})}var definitionErrorRules=obj.v.definitionErrorRules;definitionErrorRules=eval(definitionErrorRules);for(var i in definitionErrorRules){if(isNaN(i)){continue}var newDiv=null;if(i==0){newDiv=$("#"+obj.v.formId).find("#definitionErrorRulesDiv1")}else{newDiv=obj.fn.addDefinitionErrorRulesDiv()}newDiv.find("input[type=checkbox][name='cus_regex']").each(function(){if($(this).val()==definitionErrorRules[i]["cus_regex"]){this.checked=true}else{this.checked=false}});newDiv.find("#cus_label").val(definitionErrorRules[i]["cus_label"]);newDiv.find("#cus_contain").val(definitionErrorRules[i]["cus_contain"]);newDiv.find("#cus_data").val(definitionErrorRules[i]["cus_data"]);newDiv.find(" input[type=radio][value='"+definitionErrorRules[i]["cus_condition"]+"']").attr("checked",true)}});return}},create:function(){if(obj.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}var id=$("#"+obj.v.formId).find("#id").val();var name=$("#"+obj.v.formId).find("#name").val();var type=getCheckbox(obj.v.formId,"type");var isSave=getCheckbox(obj.v.formId,"isSave");var status="A";var errorTimesAllowed=$("#"+obj.v.formId).find("#errorTimesAllowed").val();var isDeploy=getCheckbox(obj.v.formId,"isDeploy");var deployId=null;if(isDeploy=="true"){deployId=$("#"+obj.v.formId).find("#deployId").val()}var isChangeUrlStatus=getCheckbox(obj.v.formId,"isChangeUrlStatus");var changeUrlStatus=$("#"+obj.v.formId).find("#changeUrlStatus").val();var isTriggerException=getCheckbox(obj.v.formId,"isTriggerException");if(isTriggerException=="true"){isTriggerException=true}else{isTriggerException=false}var sourceContainText=null;var sourceContain=null;var sourceContainIsRegex=null;var definitionErrorResponseCode=$("#"+obj.v.formId).find("#definitionErrorResponseCode").val();var definitionErrorRules=null;var definitionErrorCount=null;var crawlRulesVerId=null;var intType=1;if(type=="rules"){definitionErrorCount=$("#"+obj.v.formId).find("#definitionErrorCount").val();definitionErrorRules=obj.fn.readDefinitionErrorRules();crawlRulesVerId=$("#"+obj.v.formId).find("#crawlRulesVerId").val();intType=3}else{if(type=="source"){sourceContainText=$("#"+obj.v.formId).find("#sourceContainText").val();sourceContain=$("#"+obj.v.formId).find("#sourceContain").val();sourceContainIsRegex=getCheckbox(obj.v.formId,"sourceContainIsRegex");intType=2}}jsonrpc.urlCheckService.create(function(result,exception,profile){if(exception){return}id=result;if(!isNum(id)){showInfo(nc.i18n("res.create.failure"));return}showInfo(nc.i18n("res.create.success"));obj.fn.query();updateSelect(id,name,"urlCheckId")},obj.v.webCrawlerId,obj.v.siteId,name,status,isSave,isDeploy,deployId,errorTimesAllowed,isChangeUrlStatus,changeUrlStatus,definitionErrorCount,definitionErrorResponseCode,definitionErrorRules,crawlRulesVerId,intType,sourceContainText,sourceContain,sourceContainIsRegex,isTriggerException)},readDefinitionErrorRules:function(){var definitionErrorRules=null;$(".definitionErrorRulesLeft").each(function(index){var cus_label=$(this).find("#cus_label").val();var cus_data=$(this).find("#cus_data").val();if(cus_label!=null&&cus_label!=""&&cus_data!=null&&cus_data!=""){var cus_condition=$(this).parent().find("input[type=radio]:checked").val();var cus_contain=$(this).find("#cus_contain").val();var cus_regex=$(this).find("input[type=checkbox][name='cus_regex']:checked").val();if(cus_regex==undefined||cus_regex=="undefined"){cus_regex=""}if(cus_condition==undefined||cus_condition=="undefined"){cus_condition=""}cus_data=replaceJsonStr(cus_data);var json='{"cus_regex":"'+cus_regex+'", "cus_label":"'+cus_label+'", "cus_contain":"'+cus_contain+'", "cus_data":"'+cus_data+'", "cus_condition":"'+cus_condition+'"}';if(definitionErrorRules==null){definitionErrorRules=json}else{definitionErrorRules=definitionErrorRules+","+json}}});if(definitionErrorRules!=null){definitionErrorRules="["+definitionErrorRules+"]"}return definitionErrorRules},update:function(){var id=getRadio(obj.v.formId,"urlCheckList");if(id==null||id.length==0){showInfo(nc.i18n("res.select"));return false}if(obj.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}var name=$("#"+obj.v.formId).find("#name").val();var url=$("#"+obj.v.formId).find("#url").val();var type=getCheckbox(obj.v.formId,"type");var isSave=getCheckbox(obj.v.formId,"isSave");var status="A";var errorTimesAllowed=$("#"+obj.v.formId).find("#errorTimesAllowed").val();var isDeploy=getCheckbox(obj.v.formId,"isDeploy");var deployId=null;if(isDeploy=="true"){deployId=$("#"+obj.v.formId).find("#deployId").val()}var isChangeUrlStatus=getCheckbox(obj.v.formId,"isChangeUrlStatus");var changeUrlStatus=$("#"+obj.v.formId).find("#changeUrlStatus").val();var isTriggerException=getCheckbox(obj.v.formId,"isTriggerException");if(isTriggerException=="true"){isTriggerException=true}else{isTriggerException=false}var sourceContainText=null;var sourceContain=null;var sourceContainIsRegex=null;var definitionErrorResponseCode=$("#"+obj.v.formId).find("#definitionErrorResponseCode").val();var definitionErrorRules=null;var definitionErrorCount=null;var crawlRulesVerId=null;var intType=1;if(type=="rules"){definitionErrorCount=$("#"+obj.v.formId).find("#definitionErrorCount").val();definitionErrorRules=obj.fn.readDefinitionErrorRules();crawlRulesVerId=$("#"+obj.v.formId).find("#crawlRulesVerId").val();intType=3}else{if(type=="source"){sourceContainText=$("#"+obj.v.formId).find("#sourceContainText").val();sourceContain=$("#"+obj.v.formId).find("#sourceContain").val();sourceContainIsRegex=getCheckbox(obj.v.formId,"sourceContainIsRegex");intType=2}}jsonrpc.urlCheckService.update(function(result,exception,profile){if(exception){return}id=result;if(!isNum(id)){showInfo(nc.i18n("res.update.failure"));return}showInfo(nc.i18n("res.update.success"));obj.fn.query();updateSelect(id,name,"urlCheckId")},obj.v.webCrawlerId,obj.v.siteId,id,name,status,isSave,isDeploy,deployId,errorTimesAllowed,isChangeUrlStatus,changeUrlStatus,definitionErrorCount,definitionErrorResponseCode,definitionErrorRules,crawlRulesVerId,intType,sourceContainText,sourceContain,sourceContainIsRegex,isTriggerException)},remove:function(){var id=getRadio(obj.v.formId,"urlCheckList");if(id==null||id.length==0){showInfo(nc.i18n("res.select"));return false}if(!confirm(nc.i18n("res.remove.confirm"))){return}jsonrpc.urlCheckService.remove(function(result,exception,profile){if(exception){return}var msg=result;if(msg){showInfo(nc.i18n("res.remove.success"));obj.fn.query();removeSelect(id,"urlCheckId");return}showInfo(nc.i18n("res.remove.failure.used"))},obj.v.webCrawlerId,id)},changeOption:function(eleObj){if(eleObj.checked){$("#"+obj.v.formId).find("#"+eleObj.id+"_option").css("display","");$("#"+obj.v.formId).find("#"+eleObj.id+"_option").css("display","block")}else{$("#"+obj.v.formId).find("#"+eleObj.id+"_option").css("display","none")}obj.fn.changeDisabled()},changeMode:function(eleObj){var v=getRadio(obj.v.formId,eleObj.id);if(v=="ping"){$("#"+obj.v.formId).find(".rulesOption").hide();$("#"+obj.v.formId).find(".sourceOption").hide()}else{if(v=="source"){$("#"+obj.v.formId).find(".rulesOption").hide();$("#"+obj.v.formId).find(".sourceOption").show()}else{$("#"+obj.v.formId).find(".sourceOption").hide();$("#"+obj.v.formId).find(".rulesOption").show()}}obj.fn.changeDisabled();$("#"+obj.v.formId).find("#optionTable").find("tr:visible:odd").css("background","#FFFFFF");$("#"+obj.v.formId).find("#optionTable").find("tr:visible:even").css("background","#EEE")},changeDisabled:function(){},addDefinitionErrorRulesDiv:function(){var n=obj.v.index;obj.v.index=n+1;var newDiv=$("#"+obj.v.formId).find("#definitionErrorRulesDiv"+n).clone();newDiv.attr("id","definitionErrorRulesDiv"+obj.v.index);newDiv.find(".definitionErrorRulesCondition").remove();var conditionDiv='<div class="definitionErrorRulesCondition" style="height: 25px; margin-top: 6px;float: left;width: 100px;"><input type="radio" name="cus_condition'+obj.v.index+'" value="or">OR <input type="radio" name="cus_condition'+obj.v.index+'"  value="and">AND</div>';newDiv.prepend(conditionDiv);newDiv.appendTo("#"+obj.v.formId+" .definitionErrorRulesDiv");$("#"+obj.v.formId).find("#definitionErrorRulesDiv"+n).find(".addLabel").remove();newDiv.find("#cus_label").val("");newDiv.find("input[type=checkbox][name='cus_regex']").each(function(){this.checked=false});newDiv.find("#cus_contain").val("Y");newDiv.find("#cus_data").val("");newDiv.find(" input[type=radio][value='or']").attr("checked",true);$("#"+obj.v.formId).find(".addLabelDiv").click(function(){obj.fn.addDefinitionErrorRulesDiv()});return newDiv},addRow:function(id,name,type,isSave,isDeploy,isChangeUrlStatus,createDate){var typeDesc="";if(type==3){typeDesc=$(".type_rules").text()}else{if(type==2){typeDesc=$(".type_source").text()}else{typeDesc=$(".type_ping").text()}}var newTr="<tr class='simplehighlight'>";newTr+='<td nowrap>&nbsp;<input type="radio" name="urlCheckList" id="urlCheckList" value="'+id+'"/></td>';newTr+="<td nowrap>&nbsp;&nbsp;&nbsp;"+name+"</td>";newTr+="<td nowrap>"+typeDesc+"</td>";newTr+="<td nowrap>"+(isSave=="true"?nc.i18n("res.yes"):nc.i18n("res.no"))+"</td>";newTr+="<td nowrap>"+nc.i18n("res.isDeploy")+(isDeploy=="true"?nc.i18n("res.yes"):nc.i18n("res.no"))+"<br/>"+nc.i18n("res.isChangeUrlStatus")+(isChangeUrlStatus=="true"?nc.i18n("res.yes"):nc.i18n("res.no"))+"</td>";newTr+="<td nowrap>"+createDate+"</td>";newTr+="</tr>";var newTrObj=$(newTr);newTrObj.find("#urlCheckList").click(function(){obj.fn.edit(id)});newTrObj.appendTo("#"+obj.v.tableId);$("#"+obj.v.tableId).find("tr:odd").css("background","#FFFFFF");$("#"+obj.v.tableId).find("tr:even").css("background","rgb(247, 247, 247)");$("#"+obj.v.tableId).find(".simplehighlight").hover(function(){$(this).children().addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight")})},changeRulesVer:function(id,callback){if(id==null||id===""){$("#"+obj.v.formId).find("select[name='cus_label']").children().not(":eq(0)").remove();return}fillLabelWithName(obj.v.formId,"cus_label",id,false,callback)}}};var obj=this;obj.fn=urlcheck.fn;obj.v=option}var urlcheck=new urlcheckFun();
var myLayout;var jsonrpc;var $tabs;var configInfor;var tasksNode;var appNode;var siteId;var webCrawlerId;var siteJsonData=new Array();var siteJsonDataMap=new Map();var httpRequestJsonData;var customInterJsonData;var customPluginJsonData;var emailNoticeJsonData;var baseUrl;$(document).ready(function(){$("#loading").css("display","none");$("#optional-container").css("display","block");myLayout=$("#optional-container").layout({applyDefaultStyles:true});$tabs=$("#tabsview").tabs({cache:true,ajaxOptions:{async:true},select:function(a,b){if($(b.panel).is(":empty")){$(b.panel).append("<div class='tab-loading'></div>")}},load:function(a,b){$(b.panel).find(".tab-loading").remove();$(":button").addClass("jfk-button jfk-button-standard");$(":checkbox").addClass("jfk-checkbox")},tabTemplate:"<li><a href='#{href}' style='cursor: default;'>#{label}</a><span class='ui-icon ui-icon-close' style='float: left; margin: 0.4em 0.2em 0 0;cursor: pointer;'>Close Tab</span></li>",add:function(a,b){$tabs.tabs("select",b.index)},}).scrollabletabs({customNavNext:"#n",customNavPrev:"#p",customNavFirst:"#f",customNavLast:"#l",closable:false,});jsonrpc=new JSONRpcClient("/JSON-RPC");$("#tabsview span.ui-icon-close").live("click",function(){var a=$("li",$tabs).index($(this).parent());$tabs.tabs("remove",a)});$(".header-footer").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")});loadMenu();baseUrl=getBasePath();document.onkeydown=bodyOnkeydown});function loadMenu(){$("#ui-layout-treeview").html("正在加载...");$.ajax({type:"GET",url:"/member/menu.html",async:true,success:function(a){$("#ui-layout-treeview").html(a);tasksNode=$("#tasksNode");appNode=$("#appNode");$("#treeview").treeview({animated:"fast",collapsed:false,unique:true});initTreeNode()}})}function selectTab(b){var a=false;$("#tabsview ul li a").each(function(c){var d=$.data(this,"load.tabs");if(b==d){a=true;$tabs.tabs("select",c);$tabs.tabs("load",c)}});return a}function bindEvent(){$(".file").unbind("click");$(".file").click(function(){var b=$tabs.tabs("length");var a=$(this).attr("title");siteId=$(this).attr("siteId");webCrawlerId=$(this).attr("webCrawlerId");var c=""+webCrawlerId;siteJsonData=siteJsonDataMap.get(c);if(selectTab(a)){return false}$tabs.tabs("add",$(this).attr("title"),$(this).html(),b);return false})}function initTreeNode(){var data=jsonrpc.webCrawlerAppService.query();data=eval(data);for(var i in data){var webCrawlerId=data[i]["id"];var name=data[i]["name"];createWebCrawlerNode(webCrawlerId,name)}}function createWebCrawlerNode(b,a){jsonrpc.siteTasksService.query(a,b,function(c,e,f,d,g){if(e){alert(e.message)}else{initWebCrawlerNode(c,d,g)}},b)}function initWebCrawlerNode(siteData,name,webCrawlerId){var nameNodeId="name-"+webCrawlerId;var webCrawlerNodeId="webcrawler-"+webCrawlerId;var nodeHTML="<li id='"+webCrawlerNodeId+"' class='closed' ><span id='"+nameNodeId+"' class='folder'>"+name+"</span>";nodeHTML+="<ul id='"+webCrawlerId+"'>";nodeHTML+='<li><span class="file" style="cursor: pointer;" title="/member/WebCrawlerConfig.html" webCrawlerId="'+webCrawlerId+'" siteId="">采集器设置</span></li>';nodeHTML+='<li><span class="file" style="cursor: pointer;" title="/member/EmailNotice.html" webCrawlerId="'+webCrawlerId+'" siteId="">邮件通知配置</span></li>';nodeHTML+='<li><span class="file" style="cursor: pointer;" title="/member/HttpRequest.html" webCrawlerId="'+webCrawlerId+'" siteId="">HTTP请求配置</span></li>';nodeHTML+='<li><span class="file" style="cursor: pointer;" title="/member/HttpInterManage.html" webCrawlerId="'+webCrawlerId+'"  siteId="">HTTP接口配置</span></li>';nodeHTML+='<li><span class="file" style="cursor: pointer;" title="/member/PluginManage.html" webCrawlerId="'+webCrawlerId+'"  siteId="">插件管理</span></li>';nodeHTML+='<li><span class="file" style="cursor: pointer;" title="/member/Share.html" webCrawlerId="'+webCrawlerId+'"  siteId="">采集规则分享</span></li>';nodeHTML+='<li><span class="file" style="cursor: pointer;" title="/member/BackupAndRestore.html" webCrawlerId="'+webCrawlerId+'"  siteId="">备份与恢复</span></li>';nodeHTML+='<li><span class="file" style="cursor: pointer;" title="/member/SiteTasksByCreate.html" webCrawlerId="'+webCrawlerId+'"  siteId="">添加采集站点</span></li>';nodeHTML+="</ul></li>";var branches=$(nodeHTML).appendTo("#treeview");$("#treeview").treeview({add:branches});if(siteData!=null&&siteData!=""&&siteData!="null"){siteData=eval(siteData);var key=""+webCrawlerId;siteJsonDataMap.put(key,siteData);for(var i in siteData){createSiteTaskNode(webCrawlerId,siteData[i]["id"],siteData[i]["name"])}}bindEvent()}function updateWebCrawlerNode(c,b){var a="name-"+c;$("#"+a).html(b)}function removeWebCrawlerNode(c){var b="webcrawler-"+c;var a=$("#"+b);removeNode(a)}function createSiteTaskNode(d,f,b){var e=getSiteTaskNode(d,f,b);var a=$(e).appendTo("#"+d);$("#treeview").treeview({add:a});var c=""+d;siteJsonData=siteJsonDataMap.get(c)}function addSiteJsonData(b){var a=""+webCrawlerId;siteJsonDataMap.put(a,b)}function updateSiteTaskNode(c,d,b){var a="name-"+c+"-"+d;$("#"+a).html(b)}function removeSiteTaskNode(b,d){var c="site-"+b+"-"+d;var a=$("#"+c);removeNode(a)}function getSiteTaskNode(c,f,b){var a="name-"+c+"-"+f;var e="site-"+c+"-"+f;var d="<li id='"+e+"' class='closed' ><span class='folder' id='"+a+"'>"+b+"</span><ul>";d+='<li><span class="file" style="cursor: pointer;" title="/member/SiteTasksByEdit.html" webCrawlerId="'+c+'" siteId="'+f+'">一、采集站点管理</span></li>';d+='<li><span class="file" style="cursor: pointer;" title="/member/CrawlRules.html" webCrawlerId="'+c+'" siteId="'+f+'">二、数据采集规则</span></li>';d+='<li><span class="file" style="cursor: pointer;" title="/member/CrawlUrlImport.html" webCrawlerId="'+c+'" siteId="'+f+'">三、添加采集网址</span></li>';d+='<li><span class="file" style="cursor: pointer;" title="/member/DataDeploy.html" webCrawlerId="'+c+'" siteId="'+f+'">四、数据发布规则</span></li>';d+='<li><span class="file"  style="cursor: pointer;"  title="/member/CrawlUrlList.html" webCrawlerId="'+c+'" siteId="'+f+'">五、采集网址列表</span></li>';d+='<li><span class="file"  style="cursor: pointer;"  title="/member/CrawlDataList.html" webCrawlerId="'+c+'" siteId="'+f+'">六、采集到的数据</span></li>';d+='<li><span class="file"  style="cursor: pointer;"  title="/member/UrlCheck.html" webCrawlerId="'+c+'" siteId="'+f+'">七、网址检测管理</span></li>';d+='<li><span class="file"  style="cursor: pointer;"  title="/member/ScheduledTasks.html" webCrawlerId="'+c+'" siteId="'+f+'">八、计划任务管理</span></li>';d+='<li><span class="file"  style="cursor: pointer;"  title="/member/BackupAndRestoreBySite.html" webCrawlerId="'+c+'" siteId="'+f+'">九、站点备份恢复</span></li>';d+="</ul></li>";return d}function removeNode(a){try{$("#treeview").treeview({remove:a})}catch(b){}}function querySiteList(){var data=jsonrpc.siteTasksService.query(webCrawlerId);return eval(data)}function getBasePath(){if(!configInfor){configInfor=jsonrpc.siteConfigService.getConfigInfor();configInfor="("+configInfor+")";configInfor=eval(configInfor)}return configInfor.basePath}function handlerException(a){if(a.code==JSONRpcClient.Exception.CODE_REMOTE_EXCEPTION){var c=a.msg+"";if(c=="Please Login."){login();return true}if(c!=undefined&&c!="undefined"){alert("Error:"+c);return true}var b=a.trace+"";if(b!=undefined&&b!="undefined"){message("fade","<pre>"+b+"</pre>",15000);return}}else{if(a.code==401){login();return true}}throw new JSONRpcClient.Exception(a)}function login(){alert("Please Login.");window.location.href="/login.html"}function fillHttpRequest(formId,eleId,isAllowNull){var data;if(!httpRequestJsonData){data=jsonrpc.httpRequestService.query(webCrawlerId);if(data==null||data==""){return}data=eval(data);httpRequestJsonData=data}else{data=httpRequestJsonData}$("#"+formId+" select[name='"+eleId+"']").children().remove();if(isAllowNull){addOption(formId,eleId,"","",false)}for(var i in data){addOption(formId,eleId,data[i]["name"],data[i]["id"],false)}}function fillEmailNotice(formId,eleId,isAllowNull){var data;if(!emailNoticeJsonData){data=jsonrpc.emailNoticeService.query(webCrawlerId);if(data==null||data==""){return}data=eval(data);emailNoticeJsonData=data}else{data=emailNoticeJsonData}$("#"+formId+" select[name='"+eleId+"']").children().remove();if(isAllowNull){addOption(formId,eleId,"","",false)}for(var i in data){addOption(formId,eleId,data[i]["name"],data[i]["id"],false)}}function fillCustomInter(type,formId,eleId,isAllowNull){var data;if(!customInterJsonData){data=jsonrpc.remoteInterService.query(webCrawlerId);if(data==null||data==""){return}data=eval(data);customInterJsonData=data}else{data=customInterJsonData}$("#"+formId+" select[name='"+eleId+"']").children().remove();if(isAllowNull){addOption(formId,eleId,"","",false)}for(var i in data){if(data[i]["type"]==type){addOption(formId,eleId,data[i]["name"],data[i]["id"],false)}}}function fillCustomPlugin(type,formId,eleId,isAllowNull){var data;if(!customPluginJsonData){data=jsonrpc.pluginConfigService.query(webCrawlerId);if(data==null||data==""){return}data=eval(data);customPluginJsonData=data}else{data=customPluginJsonData}$("#"+formId+" select[name='"+eleId+"']").children().remove();if(isAllowNull){addOption(formId,eleId,"","",false)}for(var i in data){if(data[i]["type"]==type){addOption(formId,eleId,data[i]["name"],data[i]["id"],false)}}};
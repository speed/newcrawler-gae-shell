var crawlExceptionUrlList={v:{PER_PAGE_ITEMS:10,ITEMS_COUNT:0,cur_page:0,tableId:"crawlExceptionUrlListTable",listTableId:"crawlUrlExceptionList",webCrawlerId:null,siteId:null,logsTimer:null,close:true,crawlDataLogId:null},fn:{init:function(){crawlExceptionUrlList.v.cur_page=0;crawlExceptionUrlList.v.ITEMS_COUNT=0;crawlExceptionUrlList.v.close=true;crawlExceptionUrlList.fn.updateCount();crawlExceptionUrlList.v.close=true;if(crawlExceptionUrlList.v.logsTimer!=null){clearTimeout(crawlExceptionUrlList.v.logsTimer)}crawlExceptionUrlList.v.logsTimer=null},statistic:function(){if(crawlExceptionUrlList.v.crawlDataLogId==null){showInfo(nc.i18n("res.params.errors"));return}showLoading($("#"+crawlExceptionUrlList.v.tableId));jsonrpc.crawlUrlExceptionService.statistic(function(a,b,c){removeLoading($("#"+crawlExceptionUrlList.v.tableId));if(b){return}var d=a;if(d){showInfo(nc.i18n("res.background.statistics"))}else{showInfo(nc.i18n("res.background.statistics.failure"))}},crawlExceptionUrlList.v.webCrawlerId,crawlExceptionUrlList.v.crawlDataLogId)},crawl:function(){if(crawlExceptionUrlList.v.crawlDataLogId==null){showInfo(nc.i18n("res.params.errors"));return}crawlExceptionUrlList.v.close=false;$("#log-box-url").dialog("open");$("#log-box-url #log").html("");var c=$("#"+crawlExceptionUrlList.v.tableId).find(":checkbox[name=id]");for(var i=0,len=c.length;i<len;i++){if(c[i].checked){var id=c[i].value;var msg=$(c[i]).parent().parent().children(":eq(0)").text();var url=$(c[i]).parent().parent().children(":eq(2)").text();msg=msg+"> <br/>  <span id='record_"+id+"'>"+nc.i18n("res.crawl.url")+url+"<br/></span>";$("#log-box-url #log").append(msg);jsonrpc.crawlUrlExceptionService.crawl(id,function(result,exception,profile,id){result="("+result+")";result=eval(result);var logSeq=result.logSeq;var message=result.message;var ele=$("#log-box-url #log #record_"+id);if(message=="success"){ele.append("  "+nc.i18n("res.crawling")+"<br/>");crawlExceptionUrlList.fn.log(ele,logSeq,0)}else{ele.append("  "+message)}},crawlExceptionUrlList.v.webCrawlerId,id)}}},log:function(ele,logSeq,startIndex){jsonrpc.logService.query(ele,function(result,exception,profile,ele){result=eval(result);for(var i in result){if(isNaN(i)){continue}startIndex++;if(result[i]=="end"){break}ele.append("  "+result[i]+"<br/>");$("#log-box-url").animate({scrollTop:ele.height()},0)}if(!crawlExceptionUrlList.v.close){crawlExceptionUrlList.v.logsTimer=setTimeout(function(){crawlExceptionUrlList.fn.log(ele,logSeq,startIndex)},3000)}},crawlExceptionUrlList.v.webCrawlerId,logSeq,startIndex,20)},search:function(){crawlExceptionUrlList.v.cur_page=0;crawlExceptionUrlList.fn.updateCount()},query:function(a){var c=a*crawlExceptionUrlList.v.PER_PAGE_ITEMS;var b=$("#"+crawlExceptionUrlList.v.tableId).find("#url").val();showLoading($("#"+crawlExceptionUrlList.v.tableId));moveAllTr(crawlExceptionUrlList.v.tableId+" #"+crawlExceptionUrlList.v.listTableId);queryLoading(crawlExceptionUrlList.v.tableId+" #"+crawlExceptionUrlList.v.listTableId);jsonrpc.crawlUrlExceptionService.query(function(d,e,f){removeLoading($("#"+crawlExceptionUrlList.v.tableId));if(e){return}var g=d;moveAllTr(crawlExceptionUrlList.v.tableId+" #"+crawlExceptionUrlList.v.listTableId);crawlExceptionUrlList.fn.showData(g)},crawlExceptionUrlList.v.webCrawlerId,crawlExceptionUrlList.v.crawlDataLogId,b,c,crawlExceptionUrlList.v.PER_PAGE_ITEMS)},updateCount:function(){var b=$("#"+crawlExceptionUrlList.v.tableId).find("#url").val();var a=$("#"+crawlExceptionUrlList.v.tableId).find("#status").val();showLoading($("#"+crawlExceptionUrlList.v.tableId));jsonrpc.crawlUrlExceptionService.count(function(c,d,e){removeLoading($("#"+crawlExceptionUrlList.v.tableId));if(d){return}crawlExceptionUrlList.v.ITEMS_COUNT=c;crawlExceptionUrlList.fn.query(crawlExceptionUrlList.v.cur_page);crawlExceptionUrlList.fn.initPagination(crawlExceptionUrlList.v.cur_page);$("#"+crawlExceptionUrlList.v.tableId).find("#URL_COUNT").html(crawlExceptionUrlList.v.ITEMS_COUNT)},crawlExceptionUrlList.v.webCrawlerId,crawlExceptionUrlList.v.crawlDataLogId)},selectAll:function(b,c,a){$("#"+c).find("input[type=checkbox][name='"+a+"']").each(function(){this.checked=b.checked})},showData:function(data){data=eval(data);var index=1;for(var i in data){if(isNaN(i)){continue}var newTr="<tr class='simplehighlight'>";newTr+="<td nowrap>"+index+"</td>";newTr+="<td nowrap><input type='checkbox' name='id' value = '"+data[i]["id"]+"'></td>";newTr+="<td nowrap ><div class='URL' contentEditable='true' style='word-break : keep-all; overflow: hidden; line-height: 25px; height:25px; text-overflow:ellipsis;'>"+data[i]["crawlUrl"]+"</div></td>";newTr+="<td nowrap>&nbsp; "+data[i]["retryTimes"]+"&nbsp; &nbsp; </td>";newTr+="<td nowrap>&nbsp; "+data[i]["retryDate"]+"&nbsp; &nbsp; </td>";newTr+="<td nowrap>&nbsp; "+data[i]["createDate"]+"&nbsp; &nbsp; </td>";newTr+="</tr>";index++;$(newTr).appendTo("#"+crawlExceptionUrlList.v.tableId+" #"+crawlExceptionUrlList.v.listTableId)}$("#"+crawlExceptionUrlList.v.tableId).find("#"+crawlExceptionUrlList.v.listTableId).find("tr:odd").css("background","#FFFFFF");$("#"+crawlExceptionUrlList.v.tableId).find("#"+crawlExceptionUrlList.v.listTableId).find("tr:even").css("background","rgb(247, 247, 247)");$("#"+crawlExceptionUrlList.v.tableId).find("#"+crawlExceptionUrlList.v.listTableId).find(".simplehighlight").hover(function(){$(this).children().addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight")});$("#"+crawlExceptionUrlList.v.tableId).find(".URL").hover(function(){$(this).css("text-overflow","clip")},function(){$(this).css("text-overflow","clip")})},initPagination:function(a){$("#"+crawlExceptionUrlList.v.tableId).find("#Pagination").pagination(crawlExceptionUrlList.v.ITEMS_COUNT,{num_edge_entries:2,num_display_entries:8,current_page:a,callback:crawlExceptionUrlList.fn.pageselectCallback,items_per_page:crawlExceptionUrlList.v.PER_PAGE_ITEMS,prev_text:nc.i18n("res.page.prev"),next_text:nc.i18n("res.page.next")})},pageselectCallback:function(a,b){crawlExceptionUrlList.v.cur_page=a;showLoading($("#"+crawlExceptionUrlList.v.tableId));crawlExceptionUrlList.fn.query(crawlExceptionUrlList.v.cur_page);return false}}};
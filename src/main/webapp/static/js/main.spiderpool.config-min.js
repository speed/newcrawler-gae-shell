var spiderPoolApp={v:{formId:"spiderPoolAppForm",tableId:"spiderPoolAppTable",jsonData:new Array()},fn:{query:function(){moveAllTr(spiderPoolApp.v.tableId);jsonrpc.spiderPoolAppService.query(function(result,exception,profile){var data=result;data=eval(data);spiderPoolApp.v.jsonData=data;for(var i in data){var id=data[i]["id"];var name=data[i]["name"];var url=data[i]["url"];var ver=data[i]["ver"];var createDate=data[i]["createDate"];spiderPoolApp.fn.addRow(id,name,url,ver,createDate)}removeLoading($("#"+spiderPoolApp.v.formId))})},upgrade:function(){var id=getRadio(spiderPoolApp.v.formId,"appList");if(id==null||id.length==0){showInfo(nc.i18n("res.select"));return false}var url=$("#"+spiderPoolApp.v.formId).find("#url").val();showLoading($("#"+spiderPoolApp.v.formId));jsonrpc.spiderPoolAppService.upgrade(function(result,exception,profile){removeLoading($("#"+spiderPoolApp.v.formId));if(exception){return}var msg=result;msg="("+msg+")";msg=eval(msg);if(msg.status=="true"){spiderPoolApp.fn.query();showInfo(nc.i18n("res.update.ver.success"))}else{showInfo(nc.i18n("res.update.ver.failure"));return false}return true},url);return true},querySpiderAppList:function(a){spiderApp.fn.detail(a)},edit:function(e){var d=spiderPoolApp.v.jsonData;for(var c in d){if(e!=d[c]["id"]){continue}var e=d[c]["id"];var b=d[c]["name"];var a=d[c]["url"];$("#"+spiderPoolApp.v.formId).find("#id").val(e);$("#"+spiderPoolApp.v.formId).find("#name").val(b);$("#"+spiderPoolApp.v.formId).find("#url").val(a);spiderPoolApp.fn.querySpiderAppList(e);spiderPoolAppConfig.fn.query(e);return}},create:function(){var b=$("#"+spiderPoolApp.v.formId).find("#name").val();var a=$("#"+spiderPoolApp.v.formId).find("#url").val();if(b==null||b==""){showInfo(nc.i18n("res.null.name"));return}if(a==null||a==""){showInfo(nc.i18n("res.null.url"));return}if(!a.endsWith("/")){a=a+"/"}showLoading($("#"+spiderPoolApp.v.formId));jsonrpc.spiderPoolAppService.create(function(c,d,e){removeLoading($("#"+spiderPoolApp.v.formId));if(d){return}var f=c;spiderPoolApp.fn.query()},b,a)},update:function(){var c=getRadio(spiderPoolApp.v.formId,"appList");if(c==null||c.length==0){showInfo(nc.i18n("res.select"));return false}var b=$("#"+spiderPoolApp.v.formId).find("#url").val();var a=$("#"+spiderPoolApp.v.formId).find("#name").val();if(a==null||a==""){showInfo(nc.i18n("res.null.name"));return}if(b==null||b==""){showInfo(nc.i18n("res.null.url"));return}if(!b.endsWith("/")){b=b+"/"}showLoading($("#"+spiderPoolApp.v.formId));jsonrpc.spiderPoolAppService.update(function(d,e,f){removeLoading($("#"+spiderPoolApp.v.formId));if(e){return}var g=d;if(g){showInfo(nc.i18n("res.update.success"));spiderPoolApp.fn.query();spiderPoolApp.fn.querySpiderAppList(c)}else{showInfo(nc.i18n("res.update.failure"));return false}return true},c,a,b);return true},remove:function(){var a=getRadio(spiderPoolApp.v.formId,"appList");if(a==null||a.length==0){showInfo(nc.i18n("res.select"));return false}if(!confirm(nc.i18n("res.remove.confirm"))){return}showLoading($("#"+spiderPoolApp.v.formId));jsonrpc.spiderPoolAppService.remove(function(b,c,d){removeLoading($("#"+spiderPoolApp.v.formId));if(c){return}var e=b;if(e){spiderPoolApp.fn.query();showInfo(nc.i18n("res.remove.success"))}else{showInfo(nc.i18n("res.remove.failure"))}},a)},clearCache:function(){var a=$("#"+spiderPoolApp.v.formId).find("#id").val();if(a==null||a.length==0){showInfo(nc.i18n("res.select"));return}showLoading($("#"+spiderPoolApp.v.formId));jsonrpc.spiderPoolService.resetSpiderCache(function(b,c,d){removeLoading($("#"+spiderPoolApp.v.formId));var e=b;if(e){showInfo(nc.i18n("res.clear.mem.success"))}else{showInfo(nc.i18n("res.clear.mem.failure"))}},a)},addRow:function(g,d,c,b,e){b=(b==null?"":b);var f=version["system.property.version.spiderpool"];f=(f==null?"":f);if(parseFloat(f)==parseFloat(b)){b=b+"<span style='color: green; font-weight: bold;'>&nbsp;&nbsp;Latest</span>"}var a="<tr class='simplehighlight'>";a+='<td nowrap>&nbsp;<input type="radio" name="appList" id="appList" value="'+g+'" onClick="spiderPoolApp.fn.edit('+g+')"/></td>';a+="<td nowrap>&nbsp;"+d+"</td>";a+="<td nowrap>"+c+"</td>";a+="<td nowrap>"+b+"</td>";a+="<td nowrap>"+e+"</td>";a+="</tr>";$(a).appendTo("#"+spiderPoolApp.v.tableId);$("#"+spiderPoolApp.v.tableId).find("tr:odd").css("background","#FFFFFF");$("#"+spiderPoolApp.v.tableId).find("tr:even").css("background","rgb(247, 247, 247)");$("#"+spiderPoolApp.v.tableId).find(".simplehighlight").hover(function(){$(this).children().addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight")})}}};var spiderApp={v:{formId:"spiderAppForm",tableId:"spiderPoolAppConfigTable"},fn:{getRateValue:function(a){var b="";$("#"+spiderApp.v.formId+" select[name='rate'] option").each(function(){if(this.text==a){b=this.value;return(false)}});return b},getRateText:function(a){var b="";$("#"+spiderApp.v.formId+" select[name=rate] option").each(function(){if(this.value==a){b=this.text;return(false)}});return b},upgrade:function(){var id=getRadio(spiderApp.v.formId,"spider_id");if(id==null||id.length==0){showInfo(nc.i18n("res.select"));return false}var url=$("#"+spiderApp.v.formId+" #url").val();showLoading($("#"+spiderPoolApp.v.formId));jsonrpc.spiderPoolAppService.upgrade(function(result,exception,profile){removeLoading($("#"+spiderPoolApp.v.formId));if(exception){return}var msg=result;msg="("+msg+")";msg=eval(msg);if(msg.status=="true"){showInfo(nc.i18n("res.update.ver.success"));$("#"+spiderApp.v.formId+" #spider_ver_"+id).html(msg.version)}else{showInfo(nc.i18n("res.update.ver.failure"));return false}return true},url);return true},create:function(){var appId=getRadio(spiderPoolApp.v.formId,"appList");if(appId==null||appId==""){showInfo(nc.i18n("res.spiderpool.select"));return}var url=$("#"+spiderApp.v.formId+" #url").val();if(url==null||url==""){showInfo(nc.i18n("res.null.url"));return}if(!url.endsWith("/")){url=url+"/"}var spiderRate=$("#"+spiderApp.v.formId+" #rate").val();showLoading($("#"+spiderPoolApp.v.formId));jsonrpc.spiderPoolService.create(function(result,exception,profile){removeLoading($("#"+spiderPoolApp.v.formId));if(exception){return}var msg=result;msg="("+msg+")";msg=eval(msg);if(msg.status=="true"){showInfo(nc.i18n("res.create.success"));var spiderDetail='{"crawlHtmlLength":"0MB","crawlUrlCount":0,"crawlUrlFailureCount":0}';var id=msg.id;var ver=msg.version;spiderApp.fn.addRow(id,url,spiderApp.fn.getRateText(spiderRate),spiderDetail,ver)}else{showInfo(nc.i18n("res.create.failure"))}},appId,url,spiderRate)},edit:function(){var d=getRadio(spiderApp.v.formId,"spider_id");var c=$("#"+spiderApp.v.formId+" #spider_url_"+d).text();var a=$("#"+spiderApp.v.formId+" #spider_rate_"+d).text();$("#"+spiderApp.v.formId+" #id").val(d);$("#"+spiderApp.v.formId+" #url").val(c);var b=spiderApp.fn.getRateValue(a);$("#"+spiderApp.v.formId+" #rate").val(b)},update:function(){var id=$("#"+spiderApp.v.formId+" #id").val();if(id==null||id.length==0){showInfo(nc.i18n("res.spider.select"));return}var url=$("#"+spiderApp.v.formId+" #url").val();if(url==null||url==""){showInfo(nc.i18n("res.null.url"));return}if(!url.endsWith("/")){url=url+"/"}var appId=getRadio(spiderPoolApp.v.formId,"appList");if(appId==null||appId==""){showInfo(nc.i18n("res.spiderpool.select"));return}var spiderRate=$("#"+spiderApp.v.formId+" #rate").val();showLoading($("#"+spiderPoolApp.v.formId));jsonrpc.spiderPoolService.update(function(result,exception,profile){removeLoading($("#"+spiderPoolApp.v.formId));if(exception){return}var msg=result;msg="("+msg+")";msg=eval(msg);if(msg.status=="true"){showInfo(nc.i18n("res.update.success"));$("#"+spiderApp.v.formId+" #spider_url_"+id).html(url);$("#"+spiderApp.v.formId+" #spider_rate_"+id).html(spiderApp.fn.getRateText(spiderRate));var spiderVer=msg.version;spiderVer=(spiderVer==null?"":spiderVer);var latestVer=version["system.property.version.spider"];latestVer=(latestVer==null?"":latestVer);if(parseFloat(latestVer)==parseFloat(spiderVer)){spiderVer=spiderVer+"<span style='color: green; font-weight: bold;'>&nbsp;&nbsp;Latest</span>"}$("#"+spiderApp.v.formId+" #spider_ver_"+id).html(spiderVer)}else{showInfo(nc.i18n("res.update.failure"))}},appId,id,url,spiderRate)},remove:function(){var b=getRadio(spiderApp.v.formId,"spider_id");$("#"+spiderApp.v.formId+" #id").val(b);if(b==null||b.length==0){showInfo(nc.i18n("res.spider.select"));return}if(!confirm(nc.i18n("res.remove.confirm"))){return}var a=getRadio(spiderPoolApp.v.formId,"appList");if(a==null||a==""){showInfo(nc.i18n("res.spiderpool.select"));return}showLoading($("#"+spiderPoolApp.v.formId));jsonrpc.spiderPoolService.remove(function(c,d,e){removeLoading($("#"+spiderPoolApp.v.formId));if(d){return}var g=c;if(g){showInfo(nc.i18n("res.remove.success"));var f=getRadio(spiderPoolApp.v.formId,"appList");spiderPoolApp.fn.querySpiderAppList(f)}else{showInfo(nc.i18n("res.remove.failure"))}},a,b)},updateSchedule:function(){var a=getRadio(spiderApp.v.formId,"spider_id");var b=$("#"+spiderApp.v.formId+" #spider_url_"+a).html();if(b==null||b==""){showInfo(nc.i18n("res.spider.select"));return}jsonrpc.spiderAppService.syncScheduleCache(function(c,d,e){if(d){return}var f=c;if(f){showInfo(nc.i18n("res.update.success"))}else{showInfo(nc.i18n("res.update.failure"))}},b)},clearCache:function(){var a=getRadio(spiderApp.v.formId,"spider_id");var b=$("#"+spiderApp.v.formId+" #spider_url_"+a).html();if(b==null||b==""){showInfo(nc.i18n("res.spider.select"));return}jsonrpc.spiderAppService.clearCache(function(c,d,e){var f=c;if(f){showInfo(nc.i18n("res.clear.mem.success"))}else{showInfo(nc.i18n("res.clear.mem.failure"))}},b)},freshList:function(){var appId=getRadio(spiderPoolApp.v.formId,"appList");if(appId==null||appId==""){showInfo(nc.i18n("res.spiderpool.select"));return}jsonrpc.spiderPoolService.query(function(result,exception,profile){if(exception){return}var data=result;data="("+data+")";data=eval(data);if(data.code=="-1"){showInfo(data.message);return}spiderApp.fn.queryDetail(appId,data.message)},appId)},detail:function(appId){if(appId==null||appId==""){return}jsonrpc.spiderPoolService.query(appId,function(result,exception,profile,appId){var data="("+result+")";data=eval(data);if(data.code=="-1"){showInfo(data.message);return}spiderApp.fn.queryDetail(appId,data.message)},appId)},queryDetail:function(appId,data){moveAllTr("spiderDetailTable");data=eval(data);for(var i in data){var id=data[i]["id"];var spiderUrl=data[i]["url"];var spiderRate=data[i]["rate"];var spiderVer=data[i]["ver"];spiderRate=spiderApp.fn.getRateText(spiderRate);spiderApp.fn.addRow(id,spiderUrl,spiderRate,null,spiderVer,false);jsonrpc.spiderPoolService.queryDetail(id,spiderUrl,spiderRate,spiderVer,function(result,exception,profile,id,spiderUrl,spiderRate,spiderVer){spiderApp.fn.addRow(id,spiderUrl,spiderRate,result,spiderVer,true)},appId,spiderUrl)}},addRow:function(id,spiderUrl,spiderRate,spiderDetail,spiderVer,isReplace){spiderVer=(spiderVer==null?"":spiderVer);var latestVer=version["system.property.version.spider"];latestVer=(latestVer==null?"":latestVer);if(parseFloat(latestVer)==parseFloat(spiderVer)){spiderVer=spiderVer+"<span style='color: green; font-weight: bold;'>&nbsp;&nbsp;Latest</span>"}spiderUrl=(spiderUrl==null?"":spiderUrl);spiderRate=(spiderRate==null?"":spiderRate);var newcontent="<tr id='spider_"+id+"' class='simplehighlight'>";newcontent+="<td nowrap><input type='radio' id='spider_id' name='spider_id' value = '"+id+"' onClick='spiderApp.fn.edit();'/></td>";newcontent+="<td nowrap><label id='spider_url_"+id+"'>"+spiderUrl+"</label></td>";newcontent+="<td nowrap><label id='spider_ver_"+id+"'>"+spiderVer+"</label></td>";newcontent+="<td nowrap><label id='spider_rate_"+id+"'>"+spiderRate+"</label></td>";if(spiderDetail=="-1"){newcontent+="<td colspan='5'>Connect app failure!</td>"}else{if(spiderDetail==null){newcontent+="<td nowrap align='right'></td>";newcontent+="<td nowrap align='right'></td>";newcontent+="<td nowrap align='right'></td>"}else{spiderDetail="("+spiderDetail+")";spiderDetail=eval(spiderDetail);newcontent+="<td nowrap align='right'>"+spiderDetail.crawlHtmlLength+"</td>";newcontent+="<td nowrap align='right'>"+spiderDetail.crawlUrlCount+"</td>";newcontent+="<td nowrap align='right'>"+spiderDetail.crawlUrlFailureCount+"</td>"}}newcontent+="</tr>";if(isReplace){$("#"+spiderApp.v.formId+" #spider_"+id).replaceWith(newcontent)}else{$(newcontent).appendTo("#"+spiderApp.v.formId+" #spiderDetailTable")}$("#"+spiderApp.v.tableId+" #spiderDetailList tr:even").css("background","#EEE");$("#"+spiderApp.v.tableId+" #spiderDetailList tr:odd").css("background","#FFFFFF");$("#"+spiderApp.v.tableId+" .simplehighlight").hover(function(){$(this).children().addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight")})}}};var spiderPoolAppConfig={v:{formId:"spiderPoolAppConfigForm"},fn:{query:function(){var appId=getRadio(spiderPoolApp.v.formId,"appList");if(appId==null||appId==""){showInfo(nc.i18n("res.spiderpool.select"));return}var data=jsonrpc.spiderPoolService.querySystemConfig(function(result,exception,profile){if(exception){return}if(result==null){return}var data="("+result+")";data=eval(data);var size=null;try{size=data["system.property.pool.size"]}catch(e){}$("#"+spiderPoolAppConfig.v.formId+" input[name='system.property.pool.size']").val(size==null?"":size)},appId)},save:function(){var c=getRadio(spiderPoolApp.v.formId,"appList");if(c==null||c==""){showInfo(nc.i18n("res.spiderpool.select"));return}var d=$("#"+spiderPoolAppConfig.v.formId+" input[name='system.property.pool.size']").val();var b={};b["system.property.pool.size"]=d;var a=$.toJSON(b);showLoading($("#"+spiderPoolAppConfig.v.formId));jsonrpc.spiderPoolService.saveSystemConfig(function(e,f,g){removeLoading($("#"+spiderPoolAppConfig.v.formId));if(f){return}var h=e;if(h){showInfo(nc.i18n("res.save.success"))}else{showInfo(nc.i18n("res.save.failure"))}},c,a)}}};
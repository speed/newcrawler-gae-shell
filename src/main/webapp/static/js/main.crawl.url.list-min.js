var crawlUrlList={v:{PER_PAGE_ITEMS:10,ITEMS_COUNT:0,cur_page:0,tableId:"crawlUrlListTable",listTableId:"crawlUrlList",webCrawlerId:null,siteId:null,logsTimer:null,close:true},fn:{init:function(){crawlUrlList.v.cur_page=0;crawlUrlList.v.ITEMS_COUNT=0;crawlUrlList.v.close=true;crawlUrlList.fn.updateCount();crawlUrlList.v.close=true;if(crawlUrlList.v.logsTimer!=null){clearTimeout(crawlUrlList.v.logsTimer)}crawlUrlList.v.logsTimer=null;initConfigBoxWithObj($("#"+crawlUrlList.v.tableId).find("#addUrl"))},statistic:function(){if(crawlUrlList.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}showLoading($("#"+crawlUrlList.v.tableId));jsonrpc.crawlUrlService.statistic(function(a,b,c){removeLoading($("#"+crawlUrlList.v.tableId));if(b){return}var d=a;if(d){showInfo(nc.i18n("res.background.statistics"))}else{showInfo(nc.i18n("res.background.statistics.failure"))}},crawlUrlList.v.webCrawlerId,crawlUrlList.v.siteId)},resetStatus:function(){if(crawlUrlList.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}var d="";var e=$("#"+crawlUrlList.v.tableId).find(":checkbox[name=id]");for(var b=0,a=e.length;b<a;b++){if(e[b].checked){if(d==""){d=e[b].value}else{d+=","+e[b].value}}}if(d==""){showInfo(nc.i18n("res.select.multi"));return}showLoading($("#"+crawlUrlList.v.tableId));jsonrpc.crawlUrlService.resetStatus(function(c,f,g){removeLoading($("#"+crawlUrlList.v.tableId));if(f){return}var h=c;if(!h){showInfo(nc.i18n("res.reset.status.failure"));return}showInfo(nc.i18n("res.reset.status.success"));crawlUrlList.fn.query(crawlUrlList.v.cur_page)},crawlUrlList.v.webCrawlerId,crawlUrlList.v.siteId,d)},updateCache:function(){if(crawlUrlList.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}showLoading($("#"+crawlUrlList.v.tableId));jsonrpc.crawlUrlService.updateCache(function(a,b,c){removeLoading($("#"+crawlUrlList.v.tableId));if(b){return}var d=a;if(d){showInfo(nc.i18n("res.reset.cache.url.success"))}else{showInfo(nc.i18n("res.reset.cache.url.failure"))}},crawlUrlList.v.webCrawlerId,crawlUrlList.v.siteId)},removeAll:function(){if(crawlUrlList.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}if(!confirm(nc.i18n("res.remove.confirm"))){return}showLoading($("#"+crawlUrlList.v.tableId));jsonrpc.crawlUrlService.remove(function(a,b,c){removeLoading($("#"+crawlUrlList.v.tableId));if(b){return}var d=a;if(!d){showInfo(nc.i18n("res.remove.failure"));return}crawlUrlList.fn.updateCount();showInfo(nc.i18n("res.removing"))},crawlUrlList.v.webCrawlerId,crawlUrlList.v.siteId)},remove:function(){if(crawlUrlList.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}if(!confirm(nc.i18n("res.remove.confirm"))){return}var d="";var e=$("#"+crawlUrlList.v.tableId).find(":checkbox[name=id]");for(var b=0,a=e.length;b<a;b++){if(e[b].checked){if(d==""){d=e[b].value}else{d+=","+e[b].value}}}showLoading($("#"+crawlUrlList.v.tableId));jsonrpc.crawlUrlService.remove(function(c,f,g){removeLoading($("#"+crawlUrlList.v.tableId));if(f){return}var h=c;if(!h){showInfo(nc.i18n("res.remove.failure"));return}showInfo(nc.i18n("res.remove.success"));crawlUrlList.fn.init()},crawlUrlList.v.webCrawlerId,crawlUrlList.v.siteId,d)},crawl:function(){if(crawlUrlList.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}crawlUrlList.v.close=false;$("#log-box-url").dialog("open");$("#log-box-url #log").html("");var c=$("#"+crawlUrlList.v.tableId).find(":checkbox[name=id]");for(var i=0,len=c.length;i<len;i++){if(c[i].checked){var id=c[i].value;var msg=$(c[i]).parent().parent().children(":eq(0)").text();var url=$(c[i]).parent().parent().children(":eq(2)").text();msg=msg+"> <br/>  <span id='record_"+id+"'>"+nc.i18n("res.crawl.url")+url+"<br/></span>";$("#log-box-url #log").append(msg);jsonrpc.crawlUrlService.crawl(id,function(result,exception,profile,id){result="("+result+")";result=eval(result);var logSeq=result.logSeq;var message=result.message;var ele=$("#log-box-url #log #record_"+id);if(message=="success"){ele.append("  "+nc.i18n("res.crawling")+"<br/>");crawlUrlList.fn.log(ele,logSeq,0)}else{ele.append("  "+message)}},crawlUrlList.v.webCrawlerId,crawlUrlList.v.siteId,id,url)}}},log:function(ele,logSeq,startIndex){jsonrpc.logService.query(ele,function(result,exception,profile,ele){result=eval(result);for(var i in result){if(isNaN(i)){continue}startIndex++;if(result[i]=="end"){break}ele.append("  "+result[i]+"<br/>");$("#log-box-url").animate({scrollTop:ele.height()},0)}if(!crawlUrlList.v.close){crawlUrlList.v.logsTimer=setTimeout(function(){crawlUrlList.fn.log(ele,logSeq,startIndex)},3000)}},crawlUrlList.v.webCrawlerId,logSeq,startIndex,20)},search:function(){crawlUrlList.v.cur_page=0;crawlUrlList.fn.updateCount()},query:function(a){var d=a*crawlUrlList.v.PER_PAGE_ITEMS;var c=$("#"+crawlUrlList.v.tableId).find("#url").val();var b=$("#"+crawlUrlList.v.tableId).find("#status").val();showLoading($("#"+crawlUrlList.v.tableId));moveAllTr(crawlUrlList.v.tableId+" #"+crawlUrlList.v.listTableId);queryLoading(crawlUrlList.v.tableId+" #"+crawlUrlList.v.listTableId);jsonrpc.crawlUrlService.query(function(e,f,g){removeLoading($("#"+crawlUrlList.v.tableId));if(f){return}var h=e;moveAllTr(crawlUrlList.v.tableId+" #"+crawlUrlList.v.listTableId);crawlUrlList.fn.showData(h)},crawlUrlList.v.webCrawlerId,crawlUrlList.v.siteId,c,b,d,crawlUrlList.v.PER_PAGE_ITEMS)},updateCount:function(){var b=$("#"+crawlUrlList.v.tableId).find("#url").val();var a=$("#"+crawlUrlList.v.tableId).find("#status").val();showLoading($("#"+crawlUrlList.v.tableId));jsonrpc.crawlUrlService.count(function(c,d,e){removeLoading($("#"+crawlUrlList.v.tableId));if(d){return}crawlUrlList.v.ITEMS_COUNT=c;crawlUrlList.fn.query(crawlUrlList.v.cur_page);crawlUrlList.fn.initPagination(crawlUrlList.v.cur_page);$("#"+crawlUrlList.v.tableId).find("#URL_COUNT").html(crawlUrlList.v.ITEMS_COUNT)},crawlUrlList.v.webCrawlerId,crawlUrlList.v.siteId,b,a)},selectAll:function(b,c,a){$("#"+c).find("input[type=checkbox][name='"+a+"']").each(function(){this.checked=b.checked})},showData:function(data){data=eval(data);var index=1;for(var i in data){if(isNaN(i)){continue}var newTr="<tr class='simplehighlight'>";newTr+="<td nowrap>"+index+"</td>";newTr+="<td nowrap><input type='checkbox' name='id' value = '"+data[i]["id"]+"'></td>";newTr+="<td nowrap ><div class='URL' contentEditable='true' style='word-break : keep-all; overflow: hidden; line-height: 25px; height:25px; text-overflow:ellipsis;'>"+data[i]["url"]+"</div></td>";newTr+="<td nowrap>&nbsp; "+data[i]["createDate"]+"&nbsp; &nbsp; </td>";newTr+="<td nowrap>&nbsp; "+(data[i]["updateDate"]==null?"":data[i]["updateDate"])+"&nbsp; &nbsp; </td>";newTr+="<td nowrap>&nbsp; "+data[i]["status"]+"</td>";newTr+="</tr>";index++;$(newTr).appendTo("#"+crawlUrlList.v.tableId+" #"+crawlUrlList.v.listTableId)}$("#"+crawlUrlList.v.tableId).find("#"+crawlUrlList.v.listTableId).find("tr:odd").css("background","#FFFFFF");$("#"+crawlUrlList.v.tableId).find("#"+crawlUrlList.v.listTableId).find("tr:even").css("background","rgb(247, 247, 247)");$("#"+crawlUrlList.v.tableId).find("#"+crawlUrlList.v.listTableId).find(".simplehighlight").hover(function(){$(this).children().addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight")});$("#"+crawlUrlList.v.tableId).find(".URL").hover(function(){$(this).css("text-overflow","clip")},function(){$(this).css("text-overflow","clip")})},initPagination:function(a){$("#"+crawlUrlList.v.tableId).find("#Pagination").pagination(crawlUrlList.v.ITEMS_COUNT,{num_edge_entries:2,num_display_entries:8,current_page:a,callback:crawlUrlList.fn.pageselectCallback,items_per_page:crawlUrlList.v.PER_PAGE_ITEMS,prev_text:nc.i18n("res.page.prev"),next_text:nc.i18n("res.page.next")})},pageselectCallback:function(a,b){crawlUrlList.v.cur_page=a;showLoading($("#"+crawlUrlList.v.tableId));crawlUrlList.fn.query(crawlUrlList.v.cur_page);return false}}};
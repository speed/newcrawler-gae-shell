var statisticInfo={v:{tableId:"statisticInfoTable",webCrawlerId:null,preTotal:null,historyRateData:null,maxtime:null,timerId:null},fn:{init:function(){statisticInfo.v.preTotal=null;statisticInfo.v.historyRateData=null;statisticInfo.v.maxtime=null;if(statisticInfo.v.timerId!=null){clearInterval(statisticInfo.v.timerId);statisticInfo.v.timerId=null}var a=$("#"+statisticInfo.v.tableId).find("#statistic_tabs").tabs({activate:function(b,c){var d=$(c.newPanel).find(".chartDiv").attr("id");console.log(d);statisticInfo.v.preTotal=null;statisticInfo.v.historyRateData=null;statisticInfo.v.maxtime=null;if(statisticInfo.v.timerId!=null){clearInterval(statisticInfo.v.timerId);statisticInfo.v.timerId=null}showLoading($("#"+statisticInfo.v.tableId));if(d=="DAY_REAL_TIME"){statisticInfo.fn.genRate("DAY_REAL_TIME")}else{if(d=="DAY_NEW_DATA"){statisticInfo.fn.queryDay(nc.i18n("res.statistic.DAY_NEW_DATA"),"DAY_NEW_DATA")}else{if(d=="DAY_NEW_URL"){statisticInfo.fn.queryDay(nc.i18n("res.statistic.DAY_NEW_URL"),"DAY_NEW_URL")}else{if(d=="DAY_URL_FETCH"){statisticInfo.fn.genUrlFetchChart()}}}}}}).addClass("ui-tabs-vertical ui-helper-clearfix");$("#statistic_tabs li").removeClass("ui-corner-top").addClass("ui-corner-left");statisticInfo.fn.genRate("DAY_REAL_TIME")},queryDay:function(title,type){var siteId=null;var startIndex=0;var size=10;jsonrpc.crawlStatisticService.queryDay(function(result,exception,profile){if(exception){removeLoading($("#"+statisticInfo.v.tableId));return}removeLoading($("#"+statisticInfo.v.tableId));var data=result;if(data!=null&&data!=""){data=eval(data);var categories=new Array();var categoriesValue=new Array();for(var i in data){if(isNaN(i)){continue}categories.push(data[i]["date"]);categoriesValue.push(data[i]["count"])}statisticInfo.fn.genChart(type,title,categories,categoriesValue)}},statisticInfo.v.webCrawlerId,siteId,type,startIndex,size)},genChart:function(d,b,a,c){$("#"+statisticInfo.v.tableId+" #"+d).highcharts({title:{text:b,x:-20},xAxis:{categories:a},tooltip:{valueSuffix:""},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:0},series:[{name:nc.i18n("res.statistic.qty"),data:c,lineWidth:2,marker:{fillColor:"#FFFFFF",lineWidth:1,lineColor:"#4D94FF"}}]})},genUrlFetchChart:function(){var siteId=null;var startIndex=0;var size=10;var categories=new Array();var categoriesValueIn=new Array();var categoriesValueOut=new Array();var title=nc.i18n("res.statistic.DAY_URL_FETCH");jsonrpc.crawlStatisticService.queryDay(function(result,exception,profile){if(exception){removeLoading($("#"+statisticInfo.v.tableId));return}var data=result;if(data!=null&&data!=""){data=eval(data);for(var i in data){if(isNaN(i)){continue}categories.push(data[i]["date"]);categoriesValueIn.push(data[i]["count"])}}jsonrpc.crawlStatisticService.queryDay(function(result,exception,profile){if(exception){removeLoading($("#"+statisticInfo.v.tableId));return}removeLoading($("#"+statisticInfo.v.tableId));var data=result;if(data!=null&&data!=""){data=eval(data);for(var i in data){if(isNaN(i)){continue}categoriesValueOut.push(data[i]["count"])}$("#"+statisticInfo.v.tableId+" #DAY_URL_FETCH").highcharts({title:{text:title,x:-20},xAxis:{categories:categories},tooltip:{valueSuffix:""},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:0},series:[{name:nc.i18n("res.statistic.DAY_URL_QUEUE_IN"),data:categoriesValueIn,lineWidth:3,color:"#FF9933",marker:{fillColor:"#FFFFFF",lineWidth:2,lineColor:"#FF9933"}},{name:nc.i18n("res.statistic.DAY_URL_QUEUE_OUT"),data:categoriesValueOut,lineWidth:1,color:"#54c380",marker:{fillColor:"#54c380",lineWidth:0,lineColor:"white"}}]})}},statisticInfo.v.webCrawlerId,siteId,"DAY_URL_QUEUE_OUT",startIndex,size)},statisticInfo.v.webCrawlerId,siteId,"DAY_URL_QUEUE_IN",startIndex,size)},genRate:function(id){jsonrpc.crawlStatisticService.querySpiderRate(function(result,exception,profile){if(exception){return}statisticInfo.v.historyRateData=eval(result);statisticInfo.fn.genRateChart("DAY_REAL_TIME")},statisticInfo.v.webCrawlerId)},genRateChart:function(id){removeLoading($("#"+statisticInfo.v.tableId));var title=nc.i18n("res.statistic.DAY_REAL_TIME");Highcharts.setOptions({global:{useUTC:false}});$("#"+statisticInfo.v.tableId+" #"+id).highcharts({chart:{animation:Highcharts.svg,marginRight:10,events:{load:function(){var series=this.series[0];statisticInfo.v.timerId=setInterval(function(){var x=(new Date()).getTime();jsonrpc.crawlStatisticService.querySpiderRateNew(function(result,exception,profile){if(exception){return}var rateData=eval(result);for(var index in rateData){if(isNaN(index)){continue}var timestamp=rateData[index][0];var total=rateData[index][1];var count=total-statisticInfo.v.preTotal;statisticInfo.v.preTotal=total;statisticInfo.v.maxtime=timestamp;series.addPoint([timestamp,count],true,true)}},statisticInfo.v.webCrawlerId,statisticInfo.v.maxtime)},60000)}}},title:{text:title,x:-20},xAxis:{type:"datetime",tickPixelInterval:120},tooltip:{formatter:function(){return"<b>"+this.series.name+"</b><br/>"+Highcharts.dateFormat("%Y-%m-%d %H:%M",this.x)+"<br/>"+Highcharts.numberFormat(this.y,0)+" Page/Minute"}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:0},plotOptions:{area:{fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,Highcharts.getOptions().colors[0]],[1,Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get("rgba")]]},marker:{radius:2},lineWidth:1,states:{hover:{lineWidth:1}},threshold:null}},series:[{type:"area",name:"Crawler Rate",data:(function(){var rateData=statisticInfo.v.historyRateData;var size=rateData.length;var i=720-size;var data=[],mintime=rateData[0][0];for(var j=-i;j<0;j+=1){data.push({x:mintime+j*1000,y:null})}for(var index in rateData){if(isNaN(index)){continue}var timestamp=rateData[index][0];var total=rateData[index][1];var count=0;if(statisticInfo.v.preTotal!=null){count=total-statisticInfo.v.preTotal}statisticInfo.v.preTotal=total;statisticInfo.v.maxtime=timestamp;data.push({x:timestamp,y:count})}return data}()),marker:{enabled:false,states:{hover:{enabled:true}}}}]})}}};
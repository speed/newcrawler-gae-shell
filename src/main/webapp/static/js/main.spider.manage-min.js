var siteSpider={v:{formId:"spiderForm",tableId:"siteSpiderTable",spiderConfigFormId:"spiderConfigForm",webCrawlerId:null,spiderJson:null},fn:{init:function(){siteSpider.fn.initSlider(0);siteSpider.fn.query();siteSpider.fn.querySpiderConfig()},querySpiderConfig:function(){jsonrpc.systemService.query(function(result,exception,profile){if(exception){return}var data=result;if(data==null){return}data="("+data+")";data=eval(data);$("#"+siteSpider.v.spiderConfigFormId+" input[name='system.property.pool.size']").val(data["system.property.pool.size"]==null?"":data["system.property.pool.size"]);$("#"+siteSpider.v.spiderConfigFormId+" select[name='system.property.pool.lbs']").val(data["system.property.pool.lbs"]==null?"":data["system.property.pool.lbs"])},siteSpider.v.webCrawlerId)},saveSpiderConfig:function(){var b={};b["system.property.pool.size"]=$("#"+siteSpider.v.spiderConfigFormId+" input[name='system.property.pool.size']").val();b["system.property.pool.lbs"]=$("#"+siteSpider.v.spiderConfigFormId+" select[name='system.property.pool.lbs']").val();showLoading($("#"+siteSpider.v.formId));var a=$.toJSON(b);jsonrpc.systemService.save(function(c,d,e){removeLoading($("#"+siteSpider.v.formId));if(d){return}var f=c;if(f){showInfo(nc.i18n("res.save.success"))}else{showInfo(nc.i18n("res.save.failure"))}},siteSpider.v.webCrawlerId,a)},initSlider:function(a){$("#"+siteSpider.v.formId).find("#rateSlider").slider({range:"min",min:1,max:20,value:a,slide:function(b,c){$("#"+siteSpider.v.formId).find("#rate").val(c.value)}});$("#"+siteSpider.v.formId).find("#rate").val($("#"+siteSpider.v.formId).find("#rateSlider").slider("value"))},query:function(){moveAllTr(siteSpider.v.tableId);queryLoading(siteSpider.v.tableId);jsonrpc.siteSpiderService.query(function(result,exception,profile){removeLoading($("#"+siteSpider.v.formId));if(exception){return}moveAllTr(siteSpider.v.tableId);var data=result;data=eval(data);siteSpider.v.spiderJson=data;for(var i in data){if(isNaN(i)){continue}var id=data[i]["id"];var status=data[i]["status"];var url=data[i]["url"];var ver=data[i]["ver"];var project=data[i]["project"];var rpcAuth=data[i]["rpcAuth"];var latestVer=configInfor["system.property.version.spider"];ver=(ver==null?"":ver);latestVer=(latestVer==null?"":latestVer);if(parseFloat(latestVer)==parseFloat(ver)){ver=ver+"<span style='color: green; font-weight: bold;'>&nbsp;&nbsp;Latest</span>"}var rate=data[i]["rate"];var createDate=data[i]["createDate"];siteSpider.fn.addRow(id,status,url,ver,rpcAuth,rate,createDate);if(url.startsWith("http")){jsonrpc.siteSpiderService.getSpiderStatusBo(data[i]["id"],function(result,exception,profile,spiderId){if(exception){return}var trId="#spider_"+spiderId;if(result=="exception"){$("#"+siteSpider.v.tableId).find(trId).find(".URL").append("<span style='color:red;padding-left: 20px;'>Connect Exception.</span>");return}if(result=="UNAUTHORIZED"){$("#"+siteSpider.v.tableId).find(trId).find(".URL").append("<span style='color:red;padding-left: 20px;'>Unauthorized HTTP responses.</span>");return}if(exception){$("#"+siteSpider.v.tableId).find(trId).find(".URL").append("<span style='color:red;padding-left: 20px;'>Exception.</span>");return}var data2=eval("("+result+")");$("#"+siteSpider.v.tableId).find(trId).find(".URL_COUNT").text(data2.crawlUrlCount);$("#"+siteSpider.v.tableId).find(trId).find(".URL_FAILURE_COUNT").text(data2.crawlUrlFailureCount);$("#"+siteSpider.v.tableId).find(trId).find(".FILE_DOWNLOAD_FAILURE").text(data2.fileDownloadFailureCount);$("#"+siteSpider.v.tableId).find(trId).find(".URL_COUNT_DAY").text(data2.crawlUrlCountDay)},url)}}},siteSpider.v.webCrawlerId)},edit:function(b){for(var a in siteSpider.v.spiderJson){if(isNaN(a)){continue}if(siteSpider.v.spiderJson[a]["id"]==b){$("#"+siteSpider.v.formId+" #id").val(siteSpider.v.spiderJson[a]["id"]);$("#"+siteSpider.v.formId+" #url").val(siteSpider.v.spiderJson[a]["url"]);$("#"+siteSpider.v.formId+" #rpcAuth").val(siteSpider.v.spiderJson[a]["rpcAuth"]);siteSpider.fn.initSlider(siteSpider.v.spiderJson[a]["rate"]);break}}},create:function(){var c=$("#"+siteSpider.v.formId+" #url").val();if(c==null||c==""){showInfo(nc.i18n("res.null.url"));return}if(!c.endsWith("/")){c=c+"/"}var b=$("#"+siteSpider.v.formId+" #rate").val();var d=$("#"+siteSpider.v.formId+" #rpcAuth").val();var a=null;jsonrpc.siteSpiderService.create(function(e,f,g){if(f){return}var h=e;siteSpider.fn.query()},siteSpider.v.webCrawlerId,c,a,b,d)},update:function(){var e=$("#"+siteSpider.v.formId+" #id").val();if(e==null||e.length==0){showInfo(nc.i18n("res.select"));return}var c=$("#"+siteSpider.v.formId+" #url").val();if(c==null||c==""){showInfo(nc.i18n("res.null.url"));return}if(!c.endsWith("/")){c=c+"/"}var b=$("#"+siteSpider.v.formId+" #rate").val();var d=$("#"+siteSpider.v.formId+" #rpcAuth").val();var a=null;jsonrpc.siteSpiderService.update(function(f,g,h){if(g){return}var i=f;if(i){siteSpider.fn.query();showInfo(nc.i18n("res.update.success"))}else{showInfo(nc.i18n("res.update.failure"))}},siteSpider.v.webCrawlerId,e,c,a,b,d)},remove:function(){var a=getRadio(siteSpider.v.formId,"appList");if(a==null||a.length==0){showInfo(nc.i18n("res.select"));return}if(!confirm(nc.i18n("res.remove.confirm"))){return}$("#"+siteSpider.v.formId+" #id").val(a);jsonrpc.siteSpiderService.remove(function(b,c,d){if(c){return}var e=b;if(e){$("#"+siteSpider.v.formId+" #appList:checked").parent().parent().remove();showInfo(nc.i18n("res.remove.success"))}else{showInfo(nc.i18n("res.remove.failure"))}},siteSpider.v.webCrawlerId,a)},addRow:function(h,c,d,b,g,f,e){var a="<tr class='simplehighlight' id='spider_"+h+"'>";a+='<td nowrap>&nbsp;<input type="radio" name="appList" id="appList" value="'+h+'" onClick="siteSpider.fn.edit('+h+')"/></td>';a+="<td nowrap>"+c+"</td>";a+='<td nowrap class="URL">'+d+"</td>";a+="<td nowrap>"+b+"</td>";a+="<td nowrap>"+g+"</td>";a+="<td nowrap>"+f+"</td>";a+="<td nowrap>"+e+"</td>";a+='<td nowrap class="URL_COUNT_DAY"></td>';a+='<td nowrap class="URL_COUNT"></td>';a+='<td nowrap class="URL_FAILURE_COUNT"></td>';a+='<td nowrap class="FILE_DOWNLOAD_FAILURE"></td>';a+="</tr>";$(a).appendTo("#"+siteSpider.v.tableId);$("#"+siteSpider.v.tableId+" tr:even").css("background","#EEE");$("#"+siteSpider.v.tableId+" tr:odd").css("background","#FFFFFF");$("#"+siteSpider.v.tableId+" .simplehighlight").hover(function(){$(this).children().addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight")})}}};
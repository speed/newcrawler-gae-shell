var siteTask={v:{jsonData:null,webCrawlerId:null,siteId:null},fn:{init:function(a){siteTask.v.jsonData=siteJsonData;siteTask.v.webCrawlerId=webCrawlerId;siteTask.v.siteId=siteId;this.hideAdvancedSettings(a);siteTask.fn.initSlider(a,0);fillQueue(a,"queueName",true,"sync_count",function(){fillQueue(a,"deployQueueName",true,"sync_count")});if(a=="siteEditForm"){fillUrlCheck(a,"urlCheckId",true,"sync_count")}else{$("#"+a).find("#urlCheckId").attr("disabled",true);$("#"+a).find("#urlCheckId").addClass("gray");$("#"+a).find("#urlCheckId").parent().find(".configBox").addClass("configBox-disabled").removeClass("configBox")}fillHttpRequest(a,"httpRequestId",true,"sync_count");fillCustomPlugin("1",a,"urlfetchPluginId",true,"sync_count");fillSite(a,"urlOriginSiteId",true);if(siteId!=null&&siteId!=""&&siteId!="undefined"){$("#"+a).find("select[id=urlOriginSiteId] option[value='"+siteId+"']").remove()}$("#"+a).find("select[id=updateMode]").change(function(){var b=$(this).val();if(b!=null&&b=="1"){$("#"+a).find("#isRepeat").attr("checked",true).attr("disabled",true);$("#"+a).find("#isLoop").attr("checked",true).attr("disabled",true);$("#"+a).find("#isRepeatData").attr("checked",false).attr("disabled",true);$("#"+a).find("#isNotSaveRepeatData").attr("checked",false).attr("disabled",true)}else{if(b!=null&&b=="2"){$("#"+a).find("#isRepeat").attr("checked",true).attr("disabled",true);$("#"+a).find("#isLoop").attr("checked",true).attr("disabled",true);$("#"+a).find("#isRepeatData").attr("checked",true).attr("disabled",true);$("#"+a).find("#isNotSaveRepeatData").attr("checked",true).attr("disabled",true)}else{$("#"+a).find("#isRepeat").attr("checked",false).attr("disabled",false);$("#"+a).find("#isLoop").attr("checked",false).attr("disabled",false);$("#"+a).find("#isRepeatData").attr("checked",false).attr("disabled",false);$("#"+a).find("#isNotSaveRepeatData").attr("checked",false).attr("disabled",false)}}})},initSlider:function(b,a){$("#"+b).find("#delaySlider").slider({range:"min",min:0,max:20,value:a,slide:function(c,d){$("#"+b).find("#delay").val(d.value)}});$("#"+b).find("#delay").val($("#"+b).find("#delaySlider").slider("value"))},hideAdvancedSettings:function(a){$("#"+a).find("#advanced-settings-expander").val(nc.i18n("res.advanced.display.block"));$("#"+a).find("#advanced-settings-expander").unbind("click");$("#"+a).find("#advanced-settings-expander").click(function(){siteTask.fn.showAdvancedSettings(a)});$("#"+a).find(".advanced-settings").each(function(){$(this).css({display:"none"})})},showAdvancedSettings:function(a){$("#"+a).find("#advanced-settings-expander").val(nc.i18n("res.advanced.display.none"));$("#"+a).find("#advanced-settings-expander").unbind("click");$("#"+a).find("#advanced-settings-expander").click(function(){siteTask.fn.hideAdvancedSettings(a)});$("#"+a).find(".advanced-settings").each(function(){$(this).css({display:""})})},chooseShow:function(b,a){var e=b.checked;var d="none";if(e){d="block"}var c=$(b).closest("form");var f=c.attr("id");$("#"+f).find("#"+a).css({display:d})},create:function(z){var A=$("#"+z).find("#name").val();var f=$("#"+z).find("#url").val();var t=$("#"+z).find("#desc").val();var e=$("#"+z).find("#maxSize").val();var u=$("#"+z).find("#expiredDaysUrl").val();var l=$("#"+z).find("#urlCheckId").val();var h=$("#"+z).find("#crawlNumLimit").val();var p=$("#"+z).find("#maxCrawlQueueLimit").val();var a=$("#"+z).find("#urlCheckRegex").val();var i=getCheckbox(z,"isAuto");var v=getCheckbox(z,"isRepeat");var r=getCheckbox(z,"isRepeatData");var y=getCheckbox(z,"isLoop");var k=getCheckbox(z,"isMerge");var j=getCheckbox(z,"isReverse");var w=getCheckbox(z,"isRealtimeCrawl");var n=getCheckbox(z,"isNotSaveData");var q=getCheckbox(z,"isNotSaveRepeatData");var m=$("#"+z).find("#urlfetchPluginId").val();var d=$("#"+z).find("#httpRequestId").val();var c=$("#"+z).find("#queueName").val();var o=$("#"+z).find("#deployQueueName").val();var g=$("#"+z).find("#urlOriginSiteId").val();var s=$("#"+z).find("#updateMode").val();var b=$("#"+z).find("#sessionMode").val();var x=$("#"+z).find("#delay").val();if(!IsURL(f)){showInfo(nc.i18n("res.site.url.invalid"));return}showLoading($("#"+z));jsonrpc.siteTasksService.create(function(B,C,D){removeLoading($("#"+z));if(C){return}var E=B;if(!isNum(E)){showInfo(nc.i18n("res.create.failure"));return}siteTask.fn.addJson(z,E);createSiteTaskNode(siteTask.v.webCrawlerId,E,A);bindEvent();updateSelect(E,A,"nestedSiteId");showInfo(nc.i18n("res.create.success"))},siteTask.v.webCrawlerId,A,f,t,e,i,v,r,y,k,j,u,w,h,a,n,q,m,d,c,o,g,p,s,l,b,x)},edit:function(e){var f=siteTask.v.jsonData;for(var c in f){if(isNaN(c)){continue}if(f[c]["id"]!=siteTask.v.siteId){continue}$("#"+e).find("#id").val(f[c]["id"]);$("#"+e).find("#name").val(f[c]["name"]);$("#"+e).find("#url").val(f[c]["url"]);$("#"+e).find("#desc").val(f[c]["desc"]);$("#"+e).find("#maxSize").val(f[c]["maxSize"]);$("#"+e).find("#expiredDaysUrl").val(f[c]["expiredDaysUrl"]==null?"0":f[c]["expiredDaysUrl"]);$("#"+e).find("#urlCheckId").val(f[c]["urlCheckId"]);$("#"+e).find("#crawlNumLimit").val(f[c]["crawlNumLimit"]==null?"0":f[c]["crawlNumLimit"]);$("#"+e).find("#maxCrawlQueueLimit").val(f[c]["maxCrawlQueueLimit"]==null?"0":f[c]["maxCrawlQueueLimit"]);$("#"+e).find("#urlCheckRegex").val(f[c]["urlCheckRegex"]==null?"":f[c]["urlCheckRegex"]);selectCheckbox(e,"isAuto",f[c]["isAuto"]);selectCheckbox(e,"isRepeat",f[c]["isRepeat"]);selectCheckbox(e,"isRepeatData",f[c]["isRepeatData"]);selectCheckbox(e,"isLoop",f[c]["isLoop"]);selectCheckbox(e,"isMerge",f[c]["isMerge"]);selectCheckbox(e,"isRealtimeCrawl",f[c]["isRealtimeCrawl"]);selectCheckbox(e,"isReverse",f[c]["isReverse"]);selectCheckbox(e,"isNotSaveData",f[c]["isNotSaveData"]);selectCheckbox(e,"isNotSaveRepeatData",f[c]["isNotSaveRepeatData"]);$("#"+e).find("#httpRequestId").val(f[c]["httpRequestId"]);$("#"+e).find("#urlfetchPluginId").val(f[c]["urlfetchPluginId"]);$("#"+e).find("#sessionMode").val(f[c]["sessionMode"]);$("#"+e).find("#urlOriginSiteId").val(f[c]["urlOriginSiteId"]);$("#"+e).find("#updateMode").val(f[c]["updateMode"]);if(f[c]["updateMode"]!=null&&f[c]["updateMode"]!=""){$("#"+e).find("#updateMode").change()}var b=f[c]["delay"];siteTask.fn.initSlider(e,b);var d=f[c]["queueName"];if(d==null||d==""){d="R5"}$("#"+e).find("#queueName").val(d);var a=f[c]["deployQueueName"];if(a==null||a==""){a="R4"}$("#"+e).find("#deployQueueName").val(a);return}},update:function(A){var p=$("#"+A).find("#id").val();if(p==null||p.length==0){showInfo(nc.i18n("res.site.select"));return}var B=$("#"+A).find("#name").val();var f=$("#"+A).find("#url").val();var u=$("#"+A).find("#desc").val();var e=$("#"+A).find("#maxSize").val();var v=$("#"+A).find("#expiredDaysUrl").val();var l=$("#"+A).find("#urlCheckId").val();var h=$("#"+A).find("#crawlNumLimit").val();var q=$("#"+A).find("#maxCrawlQueueLimit").val();var a=$("#"+A).find("#urlCheckRegex").val();var i=getCheckbox(A,"isAuto");var w=getCheckbox(A,"isRepeat");var s=getCheckbox(A,"isRepeatData");var z=getCheckbox(A,"isLoop");var k=getCheckbox(A,"isMerge");var j=getCheckbox(A,"isReverse");var x=getCheckbox(A,"isRealtimeCrawl");var n=getCheckbox(A,"isNotSaveData");var r=getCheckbox(A,"isNotSaveRepeatData");var d=$("#"+A).find("#httpRequestId").val();var m=$("#"+A).find("#urlfetchPluginId").val();var c=$("#"+A).find("#queueName").val();var o=$("#"+A).find("#deployQueueName").val();var g=$("#"+A).find("#urlOriginSiteId").val();var t=$("#"+A).find("#updateMode").val();var b=$("#"+A).find("#sessionMode").val();var y=$("#"+A).find("#delay").val();showLoading($("#"+A));jsonrpc.siteTasksService.update(function(C,D,E){removeLoading($("#"+A));if(D){return}var F=C;if(F){siteTask.fn.updateJson(A);updateSiteTaskNode(siteTask.v.webCrawlerId,p,B);updateSelect(p,B,"nestedSiteId");siteTask.fn.updateOtherRules(p);showInfo(nc.i18n("res.update.success"))}else{showInfo(nc.i18n("res.update.failure"))}},siteTask.v.webCrawlerId,p,B,f,u,e,i,w,s,z,k,j,v,x,h,a,n,r,m,d,c,o,g,q,t,l,b,y)},updateOtherRules:function(c){var b=siteTask.v.jsonData;for(var a in b){if(isNaN(a)){continue}if(b[a]["id"]==c){$("#crawlRulesTable").find("#crawlUrl").val(b[a]["url"]);if(!(b[a]["isLoop"]=="Y"&&b[a]["isMerge"]=="Y")){$("#crawlRulesTable").find(".mergeRules").css("display","none")}break}}},addJson:function(b,d){var a={id:d,name:$("#"+b).find("#name").val(),url:$("#"+b).find("#url").val(),desc:$("#"+b).find("#desc").val(),maxSize:$("#"+b).find("#maxSize").val(),expiredDaysUrl:$("#"+b).find("#expiredDaysUrl").val(),urlCheckId:$("#"+b).find("#urlCheckId").val(),crawlNumLimit:$("#"+b).find("#crawlNumLimit").val(),maxCrawlQueueLimit:$("#"+b).find("#maxCrawlQueueLimit").val(),urlCheckRegex:$("#"+b).find("#urlCheckRegex").val(),isAuto:getCheckbox(b,"isAuto"),isRepeat:getCheckbox(b,"isRepeat"),isRepeatData:getCheckbox(b,"isRepeatData"),isLoop:getCheckbox(b,"isLoop"),isMerge:getCheckbox(b,"isMerge"),isReverse:getCheckbox(b,"isReverse"),isRealtimeCrawl:getCheckbox(b,"isRealtimeCrawl"),isNotSaveData:getCheckbox(b,"isNotSaveData"),isNotSaveRepeatData:getCheckbox(b,"isNotSaveRepeatData"),httpRequestId:$("#"+b).find("#httpRequestId").val(),queueName:$("#"+b).find("#queueName").val(),deployQueueName:$("#"+b).find("#deployQueueName").val(),urlfetchPluginId:$("#"+b).find("#urlfetchPluginId").val(),urlOriginSiteId:$("#"+b).find("#urlOriginSiteId").val(),sessionMode:$("#"+b).find("#sessionMode").val(),delay:$("#"+b).find("#delay").val(),updateMode:$("#"+b).find("#updateMode").val()};var c=siteTask.v.jsonData;if(c==null){c=new Array()}c.push(a);addSiteJsonData(c)},updateJson:function(b){var d=$("#id").val();var c=siteTask.v.jsonData;for(var a in c){if(isNaN(a)){continue}if(c[a]["id"]!=siteTask.v.siteId){continue}c[a]["name"]=$("#"+b).find("#name").val();c[a]["url"]=$("#"+b).find("#url").val();c[a]["desc"]=$("#"+b).find("#desc").val();c[a]["maxSize"]=$("#"+b).find("#maxSize").val();c[a]["expiredDaysUrl"]=$("#"+b).find("#expiredDaysUrl").val();c[a]["urlCheckId"]=$("#"+b).find("#urlCheckId").val();c[a]["crawlNumLimit"]=$("#"+b).find("#crawlNumLimit").val();c[a]["maxCrawlQueueLimit"]=$("#"+b).find("#maxCrawlQueueLimit").val();c[a]["urlCheckRegex"]=$("#"+b).find("#urlCheckRegex").val();c[a]["isAuto"]=getCheckbox(b,"isAuto");c[a]["isRepeat"]=getCheckbox(b,"isRepeat");c[a]["isRepeatData"]=getCheckbox(b,"isRepeatData");c[a]["isLoop"]=getCheckbox(b,"isLoop");c[a]["isMerge"]=getCheckbox(b,"isMerge");c[a]["isReverse"]=getCheckbox(b,"isReverse");c[a]["isRealtimeCrawl"]=getCheckbox(b,"isRealtimeCrawl");c[a]["isNotSaveData"]=getCheckbox(b,"isNotSaveData");c[a]["isNotSaveRepeatData"]=getCheckbox(b,"isNotSaveRepeatData");c[a]["httpRequestId"]=$("#"+b).find("#httpRequestId").val();c[a]["queueName"]=$("#"+b).find("#queueName").val();c[a]["deployQueueName"]=$("#"+b).find("#deployQueueName").val();c[a]["urlfetchPluginId"]=$("#"+b).find("#urlfetchPluginId").val();c[a]["urlOriginSiteId"]=$("#"+b).find("#urlOriginSiteId").val();c[a]["updateMode"]=$("#"+b).find("#updateMode").val();c[a]["sessionMode"]=$("#"+b).find("#sessionMode").val();c[a]["delay"]=$("#"+b).find("#delay").val();return}},remove:function(a){var b=$("#"+a).find("#id").val();if(b==null||b.length==0){showInfo(nc.i18n("res.site.select"));return}if(!confirm(nc.i18n("res.remove.confirm"))){return}showLoading($("#"+a));jsonrpc.siteTasksService.removeCheck(function(c,d,e){var f=c;if(f!="success"){if(!confirm(nc.i18n("res.remove.confirm2",f))){removeLoading($("#"+a));return}}jsonrpc.siteTasksService.remove(function(g,h,i){removeLoading($("#"+a));if(h){return}f=g;if(f){removeSiteTaskNode(siteTask.v.webCrawlerId,b);removeSelectForm(a,b,"nestedSiteId");removeSelectForm("deployForm",b,"siteIdByURL");removeSelectForm("jsDependForm",b,"siteId");removeSelectForm("siteCreateForm",b,"urlOriginSiteId");removeSelectForm("urlCheckForm",b,"urlOriginSiteId");showInfo(nc.i18n("res.remove.success"))}else{showInfo(nc.i18n("res.remove.failure"))}},siteTask.v.webCrawlerId,b)},siteTask.v.webCrawlerId,b)},resetCache:function(a){var b=$("#"+a).find("#id").val();if(b==null||b.length==0){showInfo(nc.i18n("res.site.select"));return}jsonrpc.siteTasksService.resetCache(function(c,d,e){if(d){return}var f=c;if(f){showInfo(nc.i18n("res.reset.mem.success"))}else{showInfo(f)}},siteTask.v.webCrawlerId,b)},autoCrawl:function(){if(siteTask.v.siteId==null){showInfo(nc.i18n("res.site.select"));return}jsonrpc.siteCrawlTestService.crawlData(function(a,b,c){if(b){return}var d=a;if(d!=undefined){showInfo(d)}},siteTask.v.webCrawlerId,siteTask.v.siteId)}}};
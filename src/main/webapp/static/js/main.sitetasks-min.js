function addTaskAndRefresh(webCrawlerId,siteId){if(siteId!=null){jsonrpc.siteTasksService.query(function(result,exception,profile){if(exception||result==null){return}var jsonData=eval("("+result+")");addSiteJsonData(jsonData);createSiteTaskNode(webCrawlerId,jsonData.id,jsonData.name);bindEvent()},webCrawlerId,siteId)}}var siteTask={v:{jsonData:null,webCrawlerId:null,siteId:null},fn:{init:function(a){siteTask.v.jsonData=siteJsonData;siteTask.v.webCrawlerId=webCrawlerId;siteTask.v.siteId=siteId;this.hideAdvancedSettings(a);siteTask.fn.initSlider(a,0);fillQueue(a,"queueName",true,"sync_count",function(){fillQueue(a,"deployQueueName",true,"sync_count")});if(a=="siteEditForm"){fillUrlCheck(a,"urlCheckId",true,"sync_count")}else{$("#"+a).find("#urlCheckId").prop("disabled",true);$("#"+a).find("#urlCheckId").addClass("gray");$("#"+a).find("#urlCheckId").parent().find(".configBox").addClass("configBox-disabled").removeClass("configBox")}fillHttpRequest(a,"httpRequestId",true,"sync_count");fillCustomPlugin("1",a,"urlfetchPluginId",true,"sync_count");fillSite(a,"urlOriginSiteId",true);if(siteId!=null&&siteId!=""&&siteId!="undefined"){$("#"+a).find("select[id=urlOriginSiteId] option[value='"+siteId+"']").remove()}$("#"+a).find("select[id=updateMode]").change(function(){var b=$(this).val();if(b!=null&&b=="1"){$("#"+a).find("#isRepeat").prop("checked",true).prop("disabled",true);$("#"+a).find("#isLoop").prop("checked",true).prop("disabled",true);$("#"+a).find("#isRepeatData").prop("checked",false).prop("disabled",true);$("#"+a).find("#isNotSaveRepeatData").prop("checked",false).prop("disabled",true)}else{if(b!=null&&b=="2"){$("#"+a).find("#isRepeat").prop("checked",true).prop("disabled",true);$("#"+a).find("#isLoop").prop("checked",true).prop("disabled",true);$("#"+a).find("#isRepeatData").prop("checked",true).prop("disabled",true);$("#"+a).find("#isNotSaveRepeatData").prop("checked",true).prop("disabled",true)}else{$("#"+a).find("#isRepeat").prop("checked",false).prop("disabled",false);$("#"+a).find("#isLoop").prop("checked",false).prop("disabled",false);$("#"+a).find("#isRepeatData").prop("checked",false).prop("disabled",false);$("#"+a).find("#isNotSaveRepeatData").prop("checked",false).prop("disabled",false)}}});$("#"+a).find("input[id=autoInterval]").change(function(){if(this.checked){$("#"+a).find(".intervalN").hide();$("#"+a).find(".intervalY").show()}else{$("#"+a).find(".intervalN").show();$("#"+a).find(".intervalY").hide()}})},initSlider:function(b,a){$("#"+b).find("#delaySlider").slider({range:"min",min:0,max:60,value:a,slide:function(c,d){$("#"+b).find("#delay").val(d.value)}});$("#"+b).find("#delay").val($("#"+b).find("#delaySlider").slider("value"))},hideAdvancedSettings:function(a){$("#"+a).find("#advanced-settings-expander").val(nc.i18n("res.advanced.display.block"));$("#"+a).find("#advanced-settings-expander").unbind("click");$("#"+a).find("#advanced-settings-expander").click(function(){siteTask.fn.showAdvancedSettings(a)});$("#"+a).find(".advanced-settings").each(function(){$(this).css({display:"none"})})},showAdvancedSettings:function(a){$("#"+a).find("#advanced-settings-expander").val(nc.i18n("res.advanced.display.none"));$("#"+a).find("#advanced-settings-expander").unbind("click");$("#"+a).find("#advanced-settings-expander").click(function(){siteTask.fn.hideAdvancedSettings(a)});$("#"+a).find(".advanced-settings").each(function(){$(this).css({display:""})})},chooseShow:function(b,a){var e=b.checked;var d="none";if(e){d="block"}var c=$(b).closest("form");var f=c.attr("id");$("#"+f).find("#"+a).css({display:d})},create:function(D){var E=$("#"+D).find("#name").val();var f=$("#"+D).find("#url").val();var w=$("#"+D).find("#desc").val();var e=$("#"+D).find("#maxSize").val();var x=$("#"+D).find("#expiredDaysUrl").val();var n=$("#"+D).find("#urlCheckId").val();var i=$("#"+D).find("#crawlNumLimit").val();var s=$("#"+D).find("#maxCrawlQueueLimit").val();var a=$("#"+D).find("#urlCheckRegex").val();var j=getCheckbox(D,"isAuto");var z=getCheckbox(D,"isRepeat");var u=getCheckbox(D,"isRepeatData");var C=getCheckbox(D,"isLoop");var l=getCheckbox(D,"isMerge");var k=getCheckbox(D,"isReverse");var A=getCheckbox(D,"isRealtimeCrawl");var p=getCheckbox(D,"isNotSaveData");var t=getCheckbox(D,"isNotSaveRepeatData");var o=$("#"+D).find("#urlfetchPluginId").val();var d=$("#"+D).find("#httpRequestId").val();var c=$("#"+D).find("#queueName").val();var r=$("#"+D).find("#deployQueueName").val();var g=$("#"+D).find("#urlOriginSiteId").val();var v=$("#"+D).find("#updateMode").val();var b=$("#"+D).find("#sessionMode").val();var B=$("#"+D).find("#delay").val();var h=$("#"+D).find("input[id=autoInterval]").is(":checked");var y=$("#"+D).find("#interval").val();var m=$("#"+D).find("#intervalMin").val();var q=$("#"+D).find("#intervalMax").val();if(!IsURL(f)){showInfo(nc.i18n("res.site.url.invalid"));return}showLoading($("#"+D));jsonrpc.siteTasksService.create(function(F,G,H){removeLoading($("#"+D));if(G){return}var I=F;if(!isNum(I)){showInfo(nc.i18n("res.create.failure"));return}siteTask.fn.addJson(D,I);createSiteTaskNode(siteTask.v.webCrawlerId,I,E);bindEvent();updateSelect(I,E,"nestedSiteId");showInfo(nc.i18n("res.create.success"))},siteTask.v.webCrawlerId,E,f,w,e,j,z,u,C,l,k,x,A,i,a,p,t,o,d,c,r,g,s,v,n,b,B,h,y,m,q)},edit:function(e){var f=siteTask.v.jsonData;for(var c in f){if(isNaN(c)){continue}if(f[c]["id"]!=siteTask.v.siteId){continue}$("#"+e).find("#id").val(f[c]["id"]);$("#"+e).find("#name").val(f[c]["name"]);$("#"+e).find("#url").val(f[c]["url"]);$("#"+e).find("#desc").val(f[c]["desc"]);$("#"+e).find("#maxSize").val(f[c]["maxSize"]);$("#"+e).find("#expiredDaysUrl").val(f[c]["expiredDaysUrl"]==null?"0":f[c]["expiredDaysUrl"]);$("#"+e).find("#urlCheckId").val(f[c]["urlCheckId"]);$("#"+e).find("#crawlNumLimit").val(f[c]["crawlNumLimit"]==null?"0":f[c]["crawlNumLimit"]);$("#"+e).find("#maxCrawlQueueLimit").val(f[c]["maxCrawlQueueLimit"]==null?"0":f[c]["maxCrawlQueueLimit"]);$("#"+e).find("#urlCheckRegex").val(f[c]["urlCheckRegex"]==null?"":f[c]["urlCheckRegex"]);selectCheckbox(e,"isAuto",f[c]["isAuto"]);selectCheckbox(e,"isRepeat",f[c]["isRepeat"]);selectCheckbox(e,"isRepeatData",f[c]["isRepeatData"]);selectCheckbox(e,"isLoop",f[c]["isLoop"]);selectCheckbox(e,"isMerge",f[c]["isMerge"]);selectCheckbox(e,"isRealtimeCrawl",f[c]["isRealtimeCrawl"]);selectCheckbox(e,"isReverse",f[c]["isReverse"]);selectCheckbox(e,"isNotSaveData",f[c]["isNotSaveData"]);selectCheckbox(e,"isNotSaveRepeatData",f[c]["isNotSaveRepeatData"]);$("#"+e).find("#httpRequestId").val(f[c]["httpRequestId"]);$("#"+e).find("#urlfetchPluginId").val(f[c]["urlfetchPluginId"]);$("#"+e).find("#sessionMode").val(f[c]["sessionMode"]);$("#"+e).find("#urlOriginSiteId").val(f[c]["urlOriginSiteId"]);$("#"+e).find("#updateMode").val(f[c]["updateMode"]);if(f[c]["updateMode"]!=null&&f[c]["updateMode"]!=""){$("#"+e).find("#updateMode").change()}var b=f[c]["delay"];siteTask.fn.initSlider(e,b);var d=f[c]["queueName"];if(d==null||d==""){d="R5"}$("#"+e).find("#queueName").val(d);var a=f[c]["deployQueueName"];if(a==null||a==""){a="R4"}$("#"+e).find("#deployQueueName").val(a);if(f[c]["autoInterval"]!=null){$("#"+e).find("input[id=autoInterval]").prop("checked",f[c]["autoInterval"]);$("#"+e).find("input[id=autoInterval]").change();$("#"+e).find("#interval").val(f[c]["interval"]);$("#"+e).find("#intervalMin").val(f[c]["intervalMin"]);$("#"+e).find("#intervalMax").val(f[c]["intervalMax"])}return}},update:function(E){var s=$("#"+E).find("#id").val();if(s==null||s.length==0){showInfo(nc.i18n("res.site.select"));return}var F=$("#"+E).find("#name").val();var f=$("#"+E).find("#url").val();var x=$("#"+E).find("#desc").val();var e=$("#"+E).find("#maxSize").val();var y=$("#"+E).find("#expiredDaysUrl").val();var n=$("#"+E).find("#urlCheckId").val();var i=$("#"+E).find("#crawlNumLimit").val();var t=$("#"+E).find("#maxCrawlQueueLimit").val();var a=$("#"+E).find("#urlCheckRegex").val();var j=getCheckbox(E,"isAuto");var A=getCheckbox(E,"isRepeat");var v=getCheckbox(E,"isRepeatData");var D=getCheckbox(E,"isLoop");var l=getCheckbox(E,"isMerge");var k=getCheckbox(E,"isReverse");var B=getCheckbox(E,"isRealtimeCrawl");var p=getCheckbox(E,"isNotSaveData");var u=getCheckbox(E,"isNotSaveRepeatData");var d=$("#"+E).find("#httpRequestId").val();var o=$("#"+E).find("#urlfetchPluginId").val();var c=$("#"+E).find("#queueName").val();var r=$("#"+E).find("#deployQueueName").val();var g=$("#"+E).find("#urlOriginSiteId").val();var w=$("#"+E).find("#updateMode").val();var b=$("#"+E).find("#sessionMode").val();var C=$("#"+E).find("#delay").val();var h=$("#"+E).find("input[id=autoInterval]").is(":checked");var z=$("#"+E).find("#interval").val();var m=$("#"+E).find("#intervalMin").val();var q=$("#"+E).find("#intervalMax").val();showLoading($("#"+E));jsonrpc.siteTasksService.update(function(G,H,I){removeLoading($("#"+E));if(H){return}var J=G;if(J){siteTask.fn.updateJson(E);updateSiteTaskNode(siteTask.v.webCrawlerId,s,F);updateSelect(s,F,"nestedSiteId");siteTask.fn.updateOtherRules(s);showInfo(nc.i18n("res.update.success"))}else{showInfo(nc.i18n("res.update.failure"))}},siteTask.v.webCrawlerId,s,F,f,x,e,j,A,v,D,l,k,y,B,i,a,p,u,o,d,c,r,g,t,w,n,b,C,h,z,m,q)},updateOtherRules:function(c){var b=siteTask.v.jsonData;for(var a in b){if(isNaN(a)){continue}if(b[a]["id"]==c){$("#crawlRulesTable").find("#crawlUrl").val(b[a]["url"]);if(!(b[a]["isLoop"]=="Y"&&b[a]["isMerge"]=="Y")){$("#crawlRulesTable").find(".mergeRules").css("display","none")}break}}},addJson:function(b,c){var a={id:c,name:$("#"+b).find("#name").val(),url:$("#"+b).find("#url").val(),desc:$("#"+b).find("#desc").val(),maxSize:$("#"+b).find("#maxSize").val(),expiredDaysUrl:$("#"+b).find("#expiredDaysUrl").val(),urlCheckId:$("#"+b).find("#urlCheckId").val(),crawlNumLimit:$("#"+b).find("#crawlNumLimit").val(),maxCrawlQueueLimit:$("#"+b).find("#maxCrawlQueueLimit").val(),urlCheckRegex:$("#"+b).find("#urlCheckRegex").val(),isAuto:getCheckbox(b,"isAuto"),isRepeat:getCheckbox(b,"isRepeat"),isRepeatData:getCheckbox(b,"isRepeatData"),isLoop:getCheckbox(b,"isLoop"),isMerge:getCheckbox(b,"isMerge"),isReverse:getCheckbox(b,"isReverse"),isRealtimeCrawl:getCheckbox(b,"isRealtimeCrawl"),isNotSaveData:getCheckbox(b,"isNotSaveData"),isNotSaveRepeatData:getCheckbox(b,"isNotSaveRepeatData"),httpRequestId:$("#"+b).find("#httpRequestId").val(),queueName:$("#"+b).find("#queueName").val(),deployQueueName:$("#"+b).find("#deployQueueName").val(),urlfetchPluginId:$("#"+b).find("#urlfetchPluginId").val(),urlOriginSiteId:$("#"+b).find("#urlOriginSiteId").val(),sessionMode:$("#"+b).find("#sessionMode").val(),delay:$("#"+b).find("#delay").val(),updateMode:$("#"+b).find("#updateMode").val(),autoInterval:$("#"+b).find("input[id=autoInterval]").is(":checked"),interval:$("#"+b).find("#interval").val(),intervalMin:$("#"+b).find("#intervalMin").val(),intervalMax:$("#"+b).find("#intervalMax").val()};addSiteJsonData(a)},updateJson:function(b){var d=$("#id").val();var c=siteTask.v.jsonData;for(var a in c){if(isNaN(a)){continue}if(c[a]["id"]!=siteTask.v.siteId){continue}c[a]["name"]=$("#"+b).find("#name").val();c[a]["url"]=$("#"+b).find("#url").val();c[a]["desc"]=$("#"+b).find("#desc").val();c[a]["maxSize"]=$("#"+b).find("#maxSize").val();c[a]["expiredDaysUrl"]=$("#"+b).find("#expiredDaysUrl").val();c[a]["urlCheckId"]=$("#"+b).find("#urlCheckId").val();c[a]["crawlNumLimit"]=$("#"+b).find("#crawlNumLimit").val();c[a]["maxCrawlQueueLimit"]=$("#"+b).find("#maxCrawlQueueLimit").val();c[a]["urlCheckRegex"]=$("#"+b).find("#urlCheckRegex").val();c[a]["isAuto"]=getCheckbox(b,"isAuto");c[a]["isRepeat"]=getCheckbox(b,"isRepeat");c[a]["isRepeatData"]=getCheckbox(b,"isRepeatData");c[a]["isLoop"]=getCheckbox(b,"isLoop");c[a]["isMerge"]=getCheckbox(b,"isMerge");c[a]["isReverse"]=getCheckbox(b,"isReverse");c[a]["isRealtimeCrawl"]=getCheckbox(b,"isRealtimeCrawl");c[a]["isNotSaveData"]=getCheckbox(b,"isNotSaveData");c[a]["isNotSaveRepeatData"]=getCheckbox(b,"isNotSaveRepeatData");c[a]["httpRequestId"]=$("#"+b).find("#httpRequestId").val();c[a]["queueName"]=$("#"+b).find("#queueName").val();c[a]["deployQueueName"]=$("#"+b).find("#deployQueueName").val();c[a]["urlfetchPluginId"]=$("#"+b).find("#urlfetchPluginId").val();c[a]["urlOriginSiteId"]=$("#"+b).find("#urlOriginSiteId").val();c[a]["updateMode"]=$("#"+b).find("#updateMode").val();c[a]["sessionMode"]=$("#"+b).find("#sessionMode").val();c[a]["delay"]=$("#"+b).find("#delay").val();c[a]["autoInterval"]=$("#"+b).find("input[id=autoInterval]").is(":checked"),c[a]["interval"]=$("#"+b).find("#interval").val(),c[a]["intervalMin"]=$("#"+b).find("#intervalMin").val(),c[a]["intervalMax"]=$("#"+b).find("#intervalMax").val();return}},remove:function(a){var b=$("#"+a).find("#id").val();if(b==null||b.length==0){showInfo(nc.i18n("res.site.select"));return}if(!confirm(nc.i18n("res.remove.confirm"))){return}showLoading($("#"+a));jsonrpc.siteTasksService.removeCheck(function(c,d,e){var f=c;if(f!="success"){if(!confirm(nc.i18n("res.remove.confirm2",f))){removeLoading($("#"+a));return}}jsonrpc.siteTasksService.remove(function(g,h,i){removeLoading($("#"+a));if(h){return}f=g;if(f){removeSiteTaskNode(siteTask.v.webCrawlerId,b);removeSelectForm(a,b,"nestedSiteId");removeSelectForm("deployForm",b,"siteIdByURL");removeSelectForm("jsDependForm",b,"siteId");removeSelectForm("siteCreateForm",b,"urlOriginSiteId");removeSelectForm("urlCheckForm",b,"urlOriginSiteId");showInfo(nc.i18n("res.remove.success"))}else{showInfo(nc.i18n("res.remove.failure"))}},siteTask.v.webCrawlerId,b)},siteTask.v.webCrawlerId,b)},resetCache:function(a){var b=$("#"+a).find("#id").val();if(b==null||b.length==0){showInfo(nc.i18n("res.site.select"));return}jsonrpc.siteTasksService.resetCache(function(c,d,e){if(d){return}var f=c;if(f){showInfo(nc.i18n("res.reset.mem.success"))}else{showInfo(f)}},siteTask.v.webCrawlerId,b)},autoCrawl:function(){if(siteTask.v.siteId==null){showInfo(nc.i18n("res.site.select"));return}jsonrpc.siteCrawlTestService.crawlData(function(a,b,c){if(b){return}var d=a;if(d!=undefined){showInfo(d)}},siteTask.v.webCrawlerId,siteTask.v.siteId)}}};
var crawlDataList={v:{PER_PAGE_ITEMS:10,ITEMS_COUNT:0,cur_page:0,formId:"crawlDataListTable",tableId:"crawlDataList",webCrawlerId:null,siteId:null,deployMap:null},fn:{init:function(){crawlDataList.v.cur_page=0;crawlDataList.v.ITEMS_COUNT=0;crawlDataList.v.PER_PAGE_ITEMS=10;crawlDataList.fn.updateCount();$("#"+crawlDataList.v.formId).find("#pageSizeSlider").slider({range:"min",min:1,max:50,value:10,slide:function(a,b){$("#"+crawlDataList.v.formId).find("#pageSize").val(b.value)}});$("#"+crawlDataList.v.formId).find("#pageSize").val($("#"+crawlDataList.v.formId).find("#pageSizeSlider").slider("value"))},statistic:function(){if(crawlDataList.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}showLoading($("#"+crawlDataList.v.formId));jsonrpc.crawlDataService.statistic(function(a,b,c){removeLoading($("#"+crawlDataList.v.formId));if(b){return}var d=a;if(d){showInfo(nc.i18n("res.background.statistics"))}else{showInfo(nc.i18n("res.background.statistics.failure"))}},crawlDataList.v.webCrawlerId,crawlDataList.v.siteId)},updateCount:function(){jsonrpc.crawlDataService.count(function(a,b,c){if(b){return}crawlDataList.v.ITEMS_COUNT=a;$("#"+crawlDataList.v.formId).find("#ITEM_COUNT").html(crawlDataList.v.ITEMS_COUNT);crawlDataList.fn.query(crawlDataList.v.cur_page);crawlDataList.fn.initPagination(crawlDataList.v.cur_page)},crawlDataList.v.webCrawlerId,crawlDataList.v.siteId)},remove:function(){if(crawlDataList.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}var d="";var e=$("#"+crawlDataList.v.formId).find(":checkbox[name=id]");for(var b=0,a=e.length;b<a;b++){if(e[b].checked){if(d==""){d=e[b].value}else{d+=","+e[b].value}}}if(!confirm(nc.i18n("res.remove.confirm"))){return}showLoading($("#"+crawlDataList.v.formId));jsonrpc.crawlDataService.remove(function(c,f,g){removeLoading($("#"+crawlDataList.v.formId));if(f){return}var h=c;if(!h){showInfo(nc.i18n("res.remove.failure"));return}setTimeout("crawlDataList.fn.query("+crawlDataList.v.cur_page+")",1500);showInfo(nc.i18n("res.remove.success"))},crawlDataList.v.webCrawlerId,crawlDataList.v.siteId,d)},removeAll:function(){if(crawlDataList.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}if(!confirm(nc.i18n("res.remove.confirm"))){return}showLoading($("#"+crawlDataList.v.formId));jsonrpc.crawlDataService.remove(function(a,b,c){removeLoading($("#"+crawlDataList.v.formId));if(b){return}var d=a;if(!d){showInfo(nc.i18n("res.remove.failure"));return}setTimeout("crawlDataList.fn.init()",1500);showInfo(nc.i18n("res.removing"))},crawlDataList.v.webCrawlerId,crawlDataList.v.siteId)},deploy:function(){if(crawlDataList.v.siteId==null){showInfo(nc.i18n("res.site.invalid.refresh"));return}$("#log-box-data").dialog("open");$("#log-box-data #log").html("");var f=$("#"+crawlDataList.v.formId).find(":checkbox[name=id]");for(var b=0,a=f.length;b<a;b++){if(f[b].checked){var e=f[b].value;var d=$(f[b]).parent().parent().children(":first").html();d=d+"> <br/><span id='record_"+e+"'>  "+nc.i18n("res.released")+"<br/></span>";$("#log-box-data #log").append(d);jsonrpc.crawlDataService.deploy(e,function(c,g,h,i){$("#log-box-data #log #record_"+i).html(c)},crawlDataList.v.webCrawlerId,crawlDataList.v.siteId,e)}}},selectAll:function(b,c,a){$("#"+c).find("input[type=checkbox][name='"+a+"']").each(function(){this.checked=b.checked})},search:function(){crawlDataList.v.cur_page=0;$("#"+crawlDataList.v.formId).find("#Pagination").html("");crawlDataList.fn.query(crawlDataList.v.cur_page);var a=$("#"+crawlDataList.v.formId).find("#search_starttime").val();if(a==null||a==""){crawlDataList.fn.initPagination(crawlDataList.v.cur_page)}},query:function(cur_page){var searchStarttime=$("#"+crawlDataList.v.formId).find("#search_starttime").val();var searchEndtime=$("#"+crawlDataList.v.formId).find("#search_endtime").val();var pageSize=$("#"+crawlDataList.v.formId).find("#pageSize").val();if(pageSize==null){pageSize=crawlDataList.v.PER_PAGE_ITEMS}crawlDataList.v.PER_PAGE_ITEMS=pageSize;var startIndex=cur_page*crawlDataList.v.PER_PAGE_ITEMS;moveAllTr(crawlDataList.v.tableId);queryLoading(crawlDataList.v.tableId);jsonrpc.crawlDataService.query(function(result,exception,profile){if(exception){removeLoading($("#"+crawlDataList.v.tableId));return}moveAllTr(crawlDataList.v.tableId);var data=result;data=eval(data);var index=1;for(var i in data){if(isNaN(i)){continue}crawlDataList.fn.addRow(index,data[i]);index++}$("#"+crawlDataList.v.tableId).find("tr:odd").css("background","#FFFFFF");$("#"+crawlDataList.v.tableId).find("tr:odd").find("textarea").css("background","#FFFFFF");$("#"+crawlDataList.v.tableId).find("tr:even").css("background","rgb(247, 247, 247)");$("#"+crawlDataList.v.tableId).find("tr:even").find("textarea").css("background","rgb(247, 247, 247)");$("#"+crawlDataList.v.tableId).find(".simplehighlight").hover(function(){$(this).children().addClass("datahighlight");$(this).find("textarea").addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight");$(this).find("textarea").removeClass("datahighlight")});removeLoading($("#"+crawlDataList.v.tableId))},crawlDataList.v.webCrawlerId,{javaClass:"com.soso.web.jsonrpc.bo.CrawlDataBo",siteId:crawlDataList.v.siteId,startIndex:startIndex,size:pageSize,searchStarttime:searchStarttime,searchEndtime:searchEndtime})},addRow:function(index,data){var newTr="<tr class='simplehighlight'>";newTr+="<td nowrap>"+index+"</td>";newTr+="<td nowrap><input type='checkbox' name='id' value = '"+data.id+"'></td>";newTr+="<td nowrap><div style='padding-right:8px;height: 100%;'><textarea id='data_id_"+data.id+"' style='height: 100%;width:100%;overflow-x:visible;overflow-y:visible;border:0px;'  rows='6'>...</textarea></div></td>";newTr+="<td nowrap><div style='padding:0px 10px 0px 10px;'>"+data.createDate+"<div></td>";var log="";if(data.deployLog!=null&&data.deployLog!=""){var deployLogs=data.deployLog.split(";");for(var j=0,len=deployLogs.length;j<len;j++){var deployLog=deployLogs[j].split(":");var deployName=crawlDataList.v.deployMap.get(deployLog[0]+"");var status=(deployLog[1]=="1"?"<span class='cron-status-ok'> on time Success</span>":"<span class='cron-status-fail'> on time Failure</span>");var time=new Date(Number(deployLog[2])).format("yyyy-MM-dd hh:mm:ss");if(log!=""){log+="<br/>"}log+=deployName+"<br/>"+time+status}}var statusDesc=(data.status==1?nc.i18n("res.published"):nc.i18n("res.unpublished"));newTr+="<td nowrap>"+log+"&nbsp; &nbsp; </td>";newTr+="<td nowrap>"+statusDesc+"</td>";newTr+="</tr>";$(newTr).appendTo("#"+crawlDataList.v.tableId);var content=data.crawlUrl;var checkLog=data.checkLog;if(checkLog!=null&&checkLog!=""){content+="\r\n"+checkLog}var jsonData=data.data;if(jsonData!=null&&jsonData!=""){var json=eval(jsonData);for(var i=0,len=json.length;i<len;i++){var oneField=json[i]["name"]+"="+json[i]["value"];content+="\r\n"+oneField}}$("#"+crawlDataList.v.tableId).find("#data_id_"+data.id).val(content)},initPagination:function(a){$("#"+crawlDataList.v.formId).find("#Pagination").pagination(crawlDataList.v.ITEMS_COUNT,{num_edge_entries:2,num_display_entries:8,current_page:a,callback:crawlDataList.fn.pageselectCallback,items_per_page:crawlDataList.v.PER_PAGE_ITEMS,prev_text:nc.i18n("res.page.prev"),next_text:nc.i18n("res.page.next")})},pageselectCallback:function(a,b){showLoading($("#"+crawlDataList.v.formId));crawlDataList.v.cur_page=a;crawlDataList.fn.query(crawlDataList.v.cur_page);return false},filedownload:function(b){var a="FileDownloadStatusList.html";createTab(a,b.value)}}};
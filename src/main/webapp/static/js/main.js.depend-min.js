var jsDepend={v:{tableId:"jsDependMainTable",formId:"jsDependForm",tableId:"jsDependListTable",times:0,curIndex:0,jsArray:new Array(),resultIncludejs:"",resultExcludejs:"",excludejs:""},fn:{init:function(){jsDepend.v.times=0;jsDepend.v.curIndex=0;jsDepend.v.resultIncludejs="";jsDepend.v.resultExcludejs="";jsDepend.v.excludejs="";jsDepend.v.jsArray=new Array();for(var b in webCrawlerJsonData){if(isNaN(b)){continue}var c=webCrawlerJsonData[b]["id"];var a=webCrawlerJsonData[b]["name"];addOption(jsDepend.v.formId,"webCrawlerId",a,c,false)}removeLoading($("#"+jsDepend.v.formId))},onChangeWebCrawler:function(e){var d=""+e;var a=siteJsonDataMap.get(d);$("#"+jsDepend.v.formId).find("select[name='siteId']").children().remove();addOption(jsDepend.v.formId,"siteId","","",false);for(var c in a){var f=a[c]["id"];var b=a[c]["name"];addOption(jsDepend.v.formId,"siteId",b,f,false)}},analysisJavascript:function(){jsDepend.v.times=0;jsDepend.v.curIndex=0;jsDepend.v.jsArray=new Array();jsDepend.v.resultIncludejs="";jsDepend.v.resultExcludejs="";jsDepend.v.excludejs="";moveAllTr(jsDepend.v.tableId);jsDepend.fn.addRowTip();$("#"+jsDepend.v.formId).find("#crawlDataPreviewDiv").css({display:"block"});$("#"+jsDepend.v.formId).find("#analysisResultDiv").css({display:"none"});this.setupA()},setupA:function(){moveAllTr(jsDepend.v.tableId);queryLoading(jsDepend.v.tableId);this.analysis(null,function(d){moveAllTr(jsDepend.v.tableId);var a=d.includeJS;var c=d.content;$("#"+jsDepend.v.formId).find("#crawlData1").val(c);for(var b in a){if(isNaN(b)){continue}jsDepend.fn.addRow(b,a[b]);jsDepend.v.curIndex=b;jsDepend.v.jsArray.push(a[b])}$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']").animate({scrollTop:$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']")[0].scrollHeight},1500);jsDepend.fn.setupB()})},setupB:function(){jsDepend.v.times=jsDepend.v.times+1;$("#"+jsDepend.v.formId).find("#status_"+jsDepend.v.curIndex).html(nc.i18n("res.js.depend.analysis"));$("#"+jsDepend.v.formId).find("#crawlTimes").html(nc.i18n("res.js.depend.crawl.n",jsDepend.v.times));var b=$("#"+jsDepend.v.formId).find("#js_"+jsDepend.v.curIndex).val();var a=b;if(jsDepend.v.excludejs!=""){a=jsDepend.v.excludejs+"|$|"+a}this.analysis(a,function(d){$("#"+jsDepend.v.formId).find("#crawlDataN").val(d.content);var e=$("#"+jsDepend.v.formId).find("#crawlDataN").val();var c=$("#"+jsDepend.v.formId).find("#crawlData1").val();if(c==e){$("#"+jsDepend.v.formId).find("#status_"+jsDepend.v.curIndex).html('<img src="../../static/images/js_x.png" alt="'+nc.i18n("res.js.depend.x")+'">');if(jsDepend.v.excludejs!=""){jsDepend.v.excludejs+="|$|"}jsDepend.v.excludejs+=b;if(jsDepend.v.resultExcludejs==""){jsDepend.v.resultExcludejs=b}else{jsDepend.v.resultExcludejs=b+"\r\n"+jsDepend.v.resultExcludejs}}else{$("#"+jsDepend.v.formId).find("#status_"+jsDepend.v.curIndex).html('<img src="../../static/images/js_v.png"  alt="'+nc.i18n("res.js.depend.v")+'">');if(jsDepend.v.resultIncludejs==""){jsDepend.v.resultIncludejs=b}else{jsDepend.v.resultIncludejs=b+"\r\n"+jsDepend.v.resultIncludejs}}jsDepend.v.curIndex--;if(jsDepend.v.curIndex<0){$("#"+jsDepend.v.formId).find("#crawlDataPreviewDiv").css({display:"none"});$("#"+jsDepend.v.formId).find("#analysisResultDiv").css({display:"block"});$("#"+jsDepend.v.formId).find("#analysisResultByInclude").val(jsDepend.v.resultIncludejs);$("#"+jsDepend.v.formId).find("#analysisResultByExclude").val(jsDepend.v.resultExcludejs);return}jsDepend.fn.setupB()})},analysis:function(jsFilterRegexs,callback){var webCrawlerId=$("#"+jsDepend.v.formId).find("#webCrawlerId").val();var siteId=$("#"+jsDepend.v.formId).find("#siteId").val();var crawlUrl=$("#"+jsDepend.v.formId).find("#crawlUrl").val();jsonrpc.crawlRulesService.analysisJavascript(function(result,exception,profile){if(exception){return}var jsonData=eval("("+result+")");callback(jsonData)},webCrawlerId,siteId,crawlUrl,jsFilterRegexs)},addRow:function(c,d){var b=1+parseInt(c);var a="<tr class='simplehighlight'>";a+="<td nowrap>&nbsp;"+b+"</td>";a+='<td nowrap><div id="status_'+c+'" style="width: 70px;height: 16px;padding: 6px 0;padding-left: 30px;float: left;"> </div></td>';a+='<td nowrap><div class="inputOver"> <input id="js_'+c+'" type="text" style="border:0;width:100%;"/></div></td>';a+="</tr>";$(a).appendTo("#"+jsDepend.v.tableId);$("#js_"+c).val(d);$("#"+jsDepend.v.tableId).find("tr:odd").css("background","#FFFFFF");$("#"+jsDepend.v.tableId).find("tr:odd input[type=text]").css("background","#FFFFFF");$("#"+jsDepend.v.tableId).find("tr:even").css("background","rgb(247, 247, 247)");$("#"+jsDepend.v.tableId).find("tr:even input[type=text]").css("background","rgb(247, 247, 247)");$("#"+jsDepend.v.tableId).find(".simplehighlight").hover(function(){$(this).children().addClass("datahighlight");$(this).find("input[type=text]").addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight");$(this).find("input[type=text]").removeClass("datahighlight")})},addRowTip:function(){var a="<tr class='simplehighlight'><td nowrap colspan='3' >"+nc.i18n("res.js.depend.init.tip")+"</td></tr>";$(a).appendTo("#"+jsDepend.v.tableId);$("#"+jsDepend.v.tableId).find("tr:odd").css("background","#FFFFFF");$("#"+jsDepend.v.tableId).find("tr:even").css("background","rgb(247, 247, 247)");$("#"+jsDepend.v.tableId).find(".simplehighlight").hover(function(){$(this).children().addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight")})}}};
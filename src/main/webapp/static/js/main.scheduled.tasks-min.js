var scheduledTask={v:{jsonData:null,formId:"scheduleForm",webCrawlerId:null,siteId:null,scheduledTaskLog:null},fn:{edit:function(b){for(var a in scheduledTask.v.jsonData){if(isNaN(a)){continue}if(scheduledTask.v.jsonData[a]["id"]==b){$("#"+scheduledTask.v.formId).find("#id").val(scheduledTask.v.jsonData[a]["id"]);$("#"+scheduledTask.v.formId).find("#taskName").val(scheduledTask.v.jsonData[a]["taskName"]);$("#"+scheduledTask.v.formId).find("#scheduleTime").val(scheduledTask.v.jsonData[a]["scheduleTime"]);$("#"+scheduledTask.v.formId).find("#runMode").val(scheduledTask.v.jsonData[a]["runMode"]);$("#"+scheduledTask.v.formId).find("#runMode").change();selectRadio(scheduledTask.v.formId,"status",scheduledTask.v.jsonData[a]["status"])}}},create:function(){if($("#"+scheduledTask.v.formId).find("#taskName").val()==null){showInfo(nc.i18n("res.selectTask"));return}var b=$("#"+scheduledTask.v.formId).find("#taskName").val()[0];var a=$("#"+scheduledTask.v.formId).find("#scheduleTime").val();var c=getRadio(scheduledTask.v.formId,"status");var d=$("#"+scheduledTask.v.formId).find("#runMode").val();showLoading($("#"+scheduledTask.v.formId));jsonrpc.scheduleService.create(function(e,f,g){removeLoading($("#"+scheduledTask.v.formId));if(f){return}var h=e;if(!isNum(h)){showInfo(h);return}scheduledTask.fn.query();showInfo(nc.i18n("res.addTask.success"))},scheduledTask.v.webCrawlerId,scheduledTask.v.siteId,b,a,c,d)},remove:function(){if(!confirm(nc.i18n("res.remove.confirm"))){return}var a=$("#"+scheduledTask.v.formId).find("#id").val();if(a==null||a.length==0){showInfo(nc.i18n("res.select"));return}showLoading($("#"+scheduledTask.v.formId));jsonrpc.scheduleService.remove(function(b,c,d){removeLoading($("#"+scheduledTask.v.formId));if(c){return}var e=b;if(e){scheduledTask.fn.query();showInfo(nc.i18n("res.remove.success"))}else{showInfo(nc.i18n("res.remove.failure"))}},scheduledTask.v.webCrawlerId,a)},update:function(){var e=$("#"+scheduledTask.v.formId).find("#id").val();if(e==null||e.length==0){showInfo(nc.i18n("res.select"));return}if($("#"+scheduledTask.v.formId).find("#taskName").val()==null){showInfo(nc.i18n("res.selectTask"));return}var b=$("#"+scheduledTask.v.formId).find("#taskName").val()[0];var a=$("#"+scheduledTask.v.formId).find("#scheduleTime").val();var c=getRadio(scheduledTask.v.formId,"status");var d=$("#"+scheduledTask.v.formId).find("#runMode").val();showLoading($("#"+scheduledTask.v.formId));jsonrpc.scheduleService.update(function(f,g,h){removeLoading($("#"+scheduledTask.v.formId));if(g){return}var i=f;if(i){scheduledTask.fn.query();showInfo(nc.i18n("res.update.success"))}else{showInfo(i)}},scheduledTask.v.webCrawlerId,e,b,a,c,d)},query:function(){jsonrpc.scheduleService.queryJsonArray(function(result,exception,profile){if(exception){return}var data=result;data=eval(data);scheduledTask.v.jsonData=data;var newcontent="<table width='100%' id='taskList' class='tableList' style='border:1px solid #CCCCCC;border-collapse:collapse;background-color: #FFFFFF;'>";newcontent+="<tr><td width='30px' bgcolor='whiteSmoke'>"+nc.i18n("res.choose")+"</td><td width='50px' bgcolor='whiteSmoke'>"+nc.i18n("res.type")+"</td><td width='120px' bgcolor='whiteSmoke'>"+nc.i18n("res.taskName")+"</td><td width='50px' bgcolor='whiteSmoke'>"+nc.i18n("res.status")+"</td><td bgcolor='whiteSmoke'>"+nc.i18n("res.taskTime")+"</td></tr>";for(var i in data){if(isNaN(i)){continue}var disabled="";var taskDesc="";var type=data[i]["type"];if(type=="2"){continue}if(type=="1"){type=nc.i18n("res.system");disabled="disabled='disabled'";taskDesc=data[i]["desc"]}else{type=nc.i18n("res.custom");taskDesc=scheduledTask.fn.getTaskDesc(data[i]["taskName"])}newcontent+="<tr  class='simplehighlight'>";newcontent+="<td><input type='radio' name='id' value = '"+data[i]["id"]+"' onClick='scheduledTask.fn.edit("+data[i]["id"]+")' "+disabled+"></td>";newcontent+="<td>"+type+"</td>";newcontent+="<td>"+taskDesc+"</td>";newcontent+="<td>"+data[i]["status"]+"</td>";newcontent+="<td>"+data[i]["scheduleTime"];var lastTime=data[i]["lastTime"];if(lastTime!=null&&lastTime!=""){newcontent+="<br/><span>"+data[i]["lastTime"]+"</span> <span class='cron-status-ok'> on time</span> <span class='cron-status-ok'> Success</span>"}newcontent+="</td>";newcontent+="</tr>"}newcontent+="</table>";$("#"+scheduledTask.v.formId).find("#Searchresult").html(newcontent);$("#"+scheduledTask.v.formId).find("#taskList").find("tr:odd").css("background","#FFFFFF");$("#"+scheduledTask.v.formId).find("#taskList").find("tr:even").css("background","rgb(247, 247, 247)");$("#"+scheduledTask.v.formId).find(".simplehighlight").hover(function(){$(this).children().addClass("datahighlight")},function(){$(this).children().removeClass("datahighlight")});removeLoading($("#"+scheduledTask.v.formId))},scheduledTask.v.webCrawlerId,scheduledTask.v.siteId)},execute:function(){var b=$("#"+scheduledTask.v.formId).find("#id").val();if(b==null||b.length==0){showInfo(nc.i18n("res.selectTaskToExecute"));return}var a=$("#"+scheduledTask.v.formId).find("#taskName").val();showLoading($("#"+scheduledTask.v.formId));jsonrpc.scheduleService.execute(function(c,d,e){removeLoading($("#"+scheduledTask.v.formId));if(d){return}var f=c;if(f){showInfo(nc.i18n("res.task.execute.success"));if("CRAWL"==a){setTimeout(function(){scheduledTask.v.scheduledTaskLog.init()},5000)}}else{showInfo(f)}},scheduledTask.v.webCrawlerId,scheduledTask.v.siteId,b)},getTaskDesc:function(a){var b="";$("#"+scheduledTask.v.formId).find("select[name=taskName]").find("option").each(function(){if($(this).val()+""==a){b=$(this).text();return(false)}});return b}}};